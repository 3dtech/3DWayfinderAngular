function ClassCallback(t,e){return function(){return e.apply(t,arguments)}}function Rectangle(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n,this.intersects=function(t){return!(t.x>this.x+this.width||t.x+t.width<this.x||t.y>this.y+this.height||t.y+t.height<this.y)}}function Vector(t,e){t||(t=0),e||(e=0),this.x=t+0,this.y=e+0,this.add=function(t){return t instanceof Vector?new Vector(this.x+t.x,this.y+t.y):new Vector(this.x+t,this.y+t)},this.subtract=function(t){return t instanceof Vector?new Vector(this.x-t.x,this.y-t.y):new Vector(this.x-t,this.y-t)},this.multiply=function(t){return new Vector(this.x*t,this.y*t)},this.divide=function(t){return new Vector(this.x/t,this.y/t)},this.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},this.negative=function(){return this.multiply(-1)},this.distance=function(t){return t.subtract(this).magnitude()},this.normalize=function(){return new Vector(this.x/this.magnitude(),this.y/this.magnitude())},this.dot=function(t){return this.x*t.x+this.y*t.y},this.clamp=function(t,e){var i=new Vector(this.x,this.y);return i.x=Math.min(i.x,e.x),i.y=Math.min(i.y,e.y),i.x=Math.max(i.x,t.x),i.y=Math.max(i.y,t.y),i}}function Vector3(t,e,i){this.x=t,this.y=e,this.z=i,this.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}}function Rectangle(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n,this.intersects=function(t){return!(t.x>this.x+this.width||t.x+t.width<this.x||t.y>this.y+this.height||t.y+t.height<this.y)}}if(void 0===Float32Array)var Float32Array=function(){return[0,0]};"undefined"!=typeof window&&(window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,16)}}(),function(){window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),"function"!=typeof String.prototype.format&&(String.prototype.format=function(){var t=arguments;return this.replace(/{(\d+)}/g,function(e,i){return"undefined"!=typeof t[i]?t[i]:e})}),window.log=function(){log.history=log.history||[],log.history.push(arguments),this.console&&console.log(Array.prototype.slice.call(arguments))}),!function(t,e){"use strict";function i(){n.READY||(v.determineEventTypes(),y.each(n.gestures,function(t){P.register(t)}),v.onTouch(n.DOCUMENT,f,P.detect),v.onTouch(n.DOCUMENT,g,P.detect),n.READY=!0)}var n=function A(t,e){return new A.Instance(t,e||{})};n.VERSION="1.1.2",n.defaults={behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},n.DOCUMENT=document,n.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled,n.HAS_TOUCHEVENTS="ontouchstart"in t,n.IS_MOBILE=/mobile|tablet|ip(ad|hone|od)|android|silk/i.test(navigator.userAgent),n.NO_MOUSEEVENTS=n.HAS_TOUCHEVENTS&&n.IS_MOBILE||n.HAS_POINTEREVENTS,n.CALCULATE_INTERVAL=25;var s={},o=n.DIRECTION_DOWN="down",r=n.DIRECTION_LEFT="left",a=n.DIRECTION_UP="up",h=n.DIRECTION_RIGHT="right",u=n.POINTER_MOUSE="mouse",c=n.POINTER_TOUCH="touch",d=n.POINTER_PEN="pen",l=n.EVENT_START="start",f=n.EVENT_MOVE="move",g=n.EVENT_END="end",p=n.EVENT_RELEASE="release",m=n.EVENT_TOUCH="touch";n.READY=!1,n.plugins=n.plugins||{},n.gestures=n.gestures||{};var y=n.utils={extend:function(t,i,n){for(var s in i)!i.hasOwnProperty(s)||t[s]!==e&&n||(t[s]=i[s]);return t},on:function(t,e,i){t.addEventListener(e,i,!1)},off:function(t,e,i){t.removeEventListener(e,i,!1)},each:function(t,i,n){var s,o;if("forEach"in t)t.forEach(i,n);else if(t.length!==e){for(s=0,o=t.length;o>s;s++)if(i.call(n,t[s],s,t)===!1)return}else for(s in t)if(t.hasOwnProperty(s)&&i.call(n,t[s],s,t)===!1)return},inStr:function(t,e){return t.indexOf(e)>-1},inArray:function(t,e){if(t.indexOf){var i=t.indexOf(e);return-1===i?!1:i}for(var n=0,s=t.length;s>n;n++)if(t[n]===e)return n;return!1},toArray:function(t){return Array.prototype.slice.call(t,0)},hasParent:function(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1},getCenter:function(t){var e=[],i=[],n=[],s=[],o=Math.min,r=Math.max;return 1===t.length?{pageX:t[0].pageX,pageY:t[0].pageY,clientX:t[0].clientX,clientY:t[0].clientY}:(y.each(t,function(t){e.push(t.pageX),i.push(t.pageY),n.push(t.clientX),s.push(t.clientY)}),{pageX:(o.apply(Math,e)+r.apply(Math,e))/2,pageY:(o.apply(Math,i)+r.apply(Math,i))/2,clientX:(o.apply(Math,n)+r.apply(Math,n))/2,clientY:(o.apply(Math,s)+r.apply(Math,s))/2})},getVelocity:function(t,e,i){return{x:Math.abs(e/t)||0,y:Math.abs(i/t)||0}},getAngle:function(t,e){var i=e.clientX-t.clientX,n=e.clientY-t.clientY;return 180*Math.atan2(n,i)/Math.PI},getDirection:function(t,e){var i=Math.abs(t.clientX-e.clientX),n=Math.abs(t.clientY-e.clientY);return i>=n?t.clientX-e.clientX>0?r:h:t.clientY-e.clientY>0?a:o},getDistance:function(t,e){var i=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.sqrt(i*i+n*n)},getScale:function(t,e){return t.length>=2&&e.length>=2?this.getDistance(e[0],e[1])/this.getDistance(t[0],t[1]):1},getRotation:function(t,e){return t.length>=2&&e.length>=2?this.getAngle(e[1],e[0])-this.getAngle(t[1],t[0]):0},isVertical:function(t){return t==a||t==o},setPrefixedCss:function(t,e,i,n){var s=["","Webkit","Moz","O","ms"];e=y.toCamelCase(e);for(var o=0;o<s.length;o++){var r=e;if(s[o]&&(r=s[o]+r.slice(0,1).toUpperCase()+r.slice(1)),r in t.style){t.style[r]=(null==n||n)&&i||"";break}}},toggleBehavior:function(t,e,i){if(e&&t&&t.style){y.each(e,function(e,n){y.setPrefixedCss(t,n,e,i)});var n=i&&function(){return!1};"none"==e.userSelect&&(t.onselectstart=n),"none"==e.userDrag&&(t.ondragstart=n)}},toCamelCase:function(t){return t.replace(/[_-]([a-z])/g,function(t){return t[1].toUpperCase()})}},v=n.event={preventMouseEvents:!1,started:!1,shouldDetect:!1,on:function(t,e,i,n){var s=e.split(" ");y.each(s,function(e){y.on(t,e,i),n&&n(e)})},off:function(t,e,i,n){var s=e.split(" ");y.each(s,function(e){y.off(t,e,i),n&&n(e)})},onTouch:function(t,e,i){var o=this,r=function(s){var r,a=s.type.toLowerCase(),h=n.HAS_POINTEREVENTS,u=y.inStr(a,"mouse");u&&o.preventMouseEvents||(u&&e==l&&0===s.button?(o.preventMouseEvents=!1,o.shouldDetect=!0):h&&e==l?o.shouldDetect=1===s.buttons:u||e!=l||(o.preventMouseEvents=!0,o.shouldDetect=!0),h&&e!=g&&I.updatePointer(e,s),o.shouldDetect&&(r=o.doDetect.call(o,s,e,t,i)),r==g&&(o.preventMouseEvents=!1,o.shouldDetect=!1,I.reset()),h&&e==g&&I.updatePointer(e,s))};return this.on(t,s[e],r),r},doDetect:function(t,e,i,n){var s=this.getTouchList(t,e),o=s.length,r=e,a=s.trigger,h=o;e==l?a=m:e==g&&(a=p,h=s.length-(t.changedTouches?t.changedTouches.length:1)),h>0&&this.started&&(r=f),this.started=!0;var u=this.collectEventData(i,r,s,t);return e!=g&&n.call(P,u),a&&(u.changedLength=h,u.eventType=a,n.call(P,u),u.eventType=r,delete u.changedLength),r==g&&(n.call(P,u),this.started=!1),r},determineEventTypes:function(){var e;return e=n.HAS_POINTEREVENTS?t.PointerEvent?["pointerdown","pointermove","pointerup pointercancel lostpointercapture"]:["MSPointerDown","MSPointerMove","MSPointerUp MSPointerCancel MSLostPointerCapture"]:n.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],s[l]=e[0],s[f]=e[1],s[g]=e[2],s},getTouchList:function(t,e){if(n.HAS_POINTEREVENTS)return I.getTouchList();if(t.touches){if(e==f)return t.touches;var i=[],s=[].concat(y.toArray(t.touches),y.toArray(t.changedTouches)),o=[];return y.each(s,function(t){y.inArray(i,t.identifier)===!1&&o.push(t),i.push(t.identifier)}),o}return t.identifier=1,[t]},collectEventData:function(t,e,i,n){var s=c;return y.inStr(n.type,"mouse")||I.matchType(u,n)?s=u:I.matchType(d,n)&&(s=d),{center:y.getCenter(i),timeStamp:Date.now(),target:n.target,touches:i,eventType:e,pointerType:s,srcEvent:n,preventDefault:function(){var t=this.srcEvent;t.preventManipulation&&t.preventManipulation(),t.preventDefault&&t.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return P.stopDetect()}}}},I=n.PointerEvent={pointers:{},getTouchList:function(){var t=[];return y.each(this.pointers,function(e){t.push(e)}),t},updatePointer:function(t,e){t==g||t!=g&&1!==e.buttons?delete this.pointers[e.pointerId]:(e.identifier=e.pointerId,this.pointers[e.pointerId]=e)},matchType:function(t,e){if(!e.pointerType)return!1;var i=e.pointerType,n={};return n[u]=i===(e.MSPOINTER_TYPE_MOUSE||u),n[c]=i===(e.MSPOINTER_TYPE_TOUCH||c),n[d]=i===(e.MSPOINTER_TYPE_PEN||d),n[t]},reset:function(){this.pointers={}}},P=n.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(t,e){this.current||(this.stopped=!1,this.current={inst:t,startEvent:y.extend({},e),lastEvent:!1,lastCalcEvent:!1,futureCalcEvent:!1,lastCalcData:{},name:""},this.detect(e))},detect:function(t){if(this.current&&!this.stopped){t=this.extendEventData(t);var e=this.current.inst,i=e.options;return y.each(this.gestures,function(n){return!this.stopped&&e.enabled&&i[n.name]&&n.handler.call(n,t,e)===!1?(this.stopDetect(),!1):void 0},this),this.current&&(this.current.lastEvent=t),t.eventType==g&&this.stopDetect(),t}},stopDetect:function(){this.previous=y.extend({},this.current),this.current=null,this.stopped=!0},getCalculatedData:function(t,e,i,s,o){var r=this.current,a=!1,h=r.lastCalcEvent,u=r.lastCalcData;h&&t.timeStamp-h.timeStamp>n.CALCULATE_INTERVAL&&(e=h.center,i=t.timeStamp-h.timeStamp,s=t.center.clientX-h.center.clientX,o=t.center.clientY-h.center.clientY,a=!0),(t.eventType==m||t.eventType==p)&&(r.futureCalcEvent=t),(!r.lastCalcEvent||a)&&(u.velocity=y.getVelocity(i,s,o),u.angle=y.getAngle(e,t.center),u.direction=y.getDirection(e,t.center),r.lastCalcEvent=r.futureCalcEvent||t,r.futureCalcEvent=t),t.velocityX=u.velocity.x,t.velocityY=u.velocity.y,t.interimAngle=u.angle,t.interimDirection=u.direction},extendEventData:function(t){var e=this.current,i=e.startEvent,n=e.lastEvent||i;(t.eventType==m||t.eventType==p)&&(i.touches=[],y.each(t.touches,function(t){i.touches.push({clientX:t.clientX,clientY:t.clientY})}));var s=t.timeStamp-i.timeStamp,o=t.center.clientX-i.center.clientX,r=t.center.clientY-i.center.clientY;return this.getCalculatedData(t,n.center,s,o,r),y.extend(t,{startEvent:i,deltaTime:s,deltaX:o,deltaY:r,distance:y.getDistance(i.center,t.center),angle:y.getAngle(i.center,t.center),direction:y.getDirection(i.center,t.center),scale:y.getScale(i.touches,t.touches),rotation:y.getRotation(i.touches,t.touches)}),t},register:function(t){var i=t.defaults||{};return i[t.name]===e&&(i[t.name]=!0),y.extend(n.defaults,i,!0),t.index=t.index||1e3,this.gestures.push(t),this.gestures.sort(function(t,e){return t.index<e.index?-1:t.index>e.index?1:0}),this.gestures}};n.Instance=function(t,e){var s=this;i(),this.element=t,this.enabled=!0,y.each(e,function(t,i){delete e[i],e[y.toCamelCase(i)]=t}),this.options=y.extend(y.extend({},n.defaults),e||{}),this.options.behavior&&y.toggleBehavior(this.element,this.options.behavior,!0),this.eventStartHandler=v.onTouch(t,l,function(t){s.enabled&&t.eventType==l?P.startDetect(s,t):t.eventType==m&&P.detect(t)}),this.eventHandlers=[]},n.Instance.prototype={on:function(t,e){var i=this;return v.on(i.element,t,e,function(t){i.eventHandlers.push({gesture:t,handler:e})}),i},off:function(t,e){var i=this;return v.off(i.element,t,e,function(t){var n=y.inArray({gesture:t,handler:e});n!==!1&&i.eventHandlers.splice(n,1)}),i},trigger:function(t,e){e||(e={});var i=n.DOCUMENT.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=e;var s=this.element;return y.hasParent(e.target,s)&&(s=e.target),s.dispatchEvent(i),this},enable:function(t){return this.enabled=t,this},dispose:function(){var t,e;for(y.toggleBehavior(this.element,this.options.behavior,!1),t=-1;e=this.eventHandlers[++t];)y.off(this.element,e.gesture,e.handler);return this.eventHandlers=[],v.off(this.element,s[l],this.eventStartHandler),null}},function(t){function e(e,n){var s=P.current;if(!(n.options.dragMaxTouches>0&&e.touches.length>n.options.dragMaxTouches))switch(e.eventType){case l:i=!1;break;case f:if(e.distance<n.options.dragMinDistance&&s.name!=t)return;var u=s.startEvent.center;if(s.name!=t&&(s.name=t,n.options.dragDistanceCorrection&&e.distance>0)){var c=Math.abs(n.options.dragMinDistance/e.distance);u.pageX+=e.deltaX*c,u.pageY+=e.deltaY*c,u.clientX+=e.deltaX*c,u.clientY+=e.deltaY*c,e=P.extendEventData(e)}(s.lastEvent.dragLockToAxis||n.options.dragLockToAxis&&n.options.dragLockMinDistance<=e.distance)&&(e.dragLockToAxis=!0);var d=s.lastEvent.direction;e.dragLockToAxis&&d!==e.direction&&(e.direction=y.isVertical(d)?e.deltaY<0?a:o:e.deltaX<0?r:h),i||(n.trigger(t+"start",e),i=!0),n.trigger(t,e),n.trigger(t+e.direction,e);var m=y.isVertical(e.direction);(n.options.dragBlockVertical&&m||n.options.dragBlockHorizontal&&!m)&&e.preventDefault();break;case p:i&&e.changedLength<=n.options.dragMaxTouches&&(n.trigger(t+"end",e),i=!1);break;case g:i=!1}}var i=!1;n.gestures.Drag={name:t,index:50,handler:e,defaults:{dragMinDistance:10,dragDistanceCorrection:!0,dragMaxTouches:1,dragBlockHorizontal:!1,dragBlockVertical:!1,dragLockToAxis:!1,dragLockMinDistance:25}}}("drag"),n.gestures.Gesture={name:"gesture",index:1337,handler:function(t,e){e.trigger(this.name,t)}},function(t){function e(e,n){var s=n.options,o=P.current;switch(e.eventType){case l:clearTimeout(i),o.name=t,i=setTimeout(function(){o&&o.name==t&&n.trigger(t,e)},s.holdTimeout);break;case f:e.distance>s.holdThreshold&&clearTimeout(i);break;case p:clearTimeout(i)}}var i;n.gestures.Hold={name:t,index:10,defaults:{holdTimeout:500,holdThreshold:2},handler:e}}("hold"),n.gestures.Release={name:"release",index:1/0,handler:function(t,e){t.eventType==p&&e.trigger(this.name,t)}},n.gestures.Swipe={name:"swipe",index:40,defaults:{swipeMinTouches:1,swipeMaxTouches:1,swipeVelocityX:.6,swipeVelocityY:.6},handler:function(t,e){if(t.eventType==p){var i=t.touches.length,n=e.options;if(i<n.swipeMinTouches||i>n.swipeMaxTouches)return;(t.velocityX>n.swipeVelocityX||t.velocityY>n.swipeVelocityY)&&(e.trigger(this.name,t),e.trigger(this.name+t.direction,t))}}},function(t){function e(e,n){var s,o,r=n.options,a=P.current,h=P.previous;switch(e.eventType){case l:i=!1;break;case f:i=i||e.distance>r.tapMaxDistance;break;case g:"touchcancel"!=e.srcEvent.type&&e.deltaTime<r.tapMaxTime&&!i&&(s=h&&h.lastEvent&&e.timeStamp-h.lastEvent.timeStamp,o=!1,h&&h.name==t&&s&&s<r.doubleTapInterval&&e.distance<r.doubleTapDistance&&(n.trigger("doubletap",e),o=!0),(!o||r.tapAlways)&&(a.name=t,n.trigger(a.name,e)))}}var i=!1;n.gestures.Tap={name:t,index:100,handler:e,defaults:{tapMaxTime:250,tapMaxDistance:10,tapAlways:!0,doubleTapDistance:20,doubleTapInterval:300}}}("tap"),n.gestures.Touch={name:"touch",index:-1/0,defaults:{preventDefault:!1,preventMouse:!1},handler:function(t,e){return e.options.preventMouse&&t.pointerType==u?void t.stopDetect():(e.options.preventDefault&&t.preventDefault(),void(t.eventType==m&&e.trigger("touch",t)))}},function(t){function e(e,n){switch(e.eventType){case l:i=!1;break;case f:if(e.touches.length<2)return;var s=Math.abs(1-e.scale),o=Math.abs(e.rotation);if(s<n.options.transformMinScale&&o<n.options.transformMinRotation)return;P.current.name=t,i||(n.trigger(t+"start",e),i=!0),n.trigger(t,e),o>n.options.transformMinRotation&&n.trigger("rotate",e),s>n.options.transformMinScale&&(n.trigger("pinch",e),n.trigger("pinch"+(e.scale<1?"in":"out"),e));break;case p:i&&e.changedLength<2&&(n.trigger(t+"end",e),i=!1)}}var i=!1;n.gestures.Transform={name:t,index:45,defaults:{transformMinScale:.01,transformMinRotation:1},handler:e}}("transform"),"function"==typeof define&&define.amd?define(function(){return n}):"undefined"!=typeof module&&module.exports?module.exports=n:t.Hammer=n}(window);var Class=function(){};!function(){var t=!1,e=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(i){function n(){!t&&this.init&&this.init.apply(this,arguments)}var s=this.prototype;t=!0;var o=new this;t=!1;for(var r in i)o[r]="function"==typeof i[r]&&"function"==typeof s[r]&&e.test(i[r])?function(t,e){return function(){var i=this._super;this._super=s[t];var n=e.apply(this,arguments);return this._super=i,n}}(r,i[r]):i[r];return n.prototype=o,n.prototype.constructor=n,n.extend=arguments.callee,n}}();var Callback=ClassCallback;!function(){"use strict";var t={};"undefined"==typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(t.exports={},define(function(){return t.exports})):t.exports=window:t.exports=exports,function(t){var e={};if(!i)var i=1e-6;e.create=function(){return new Float32Array(2)},e.clone=function(t){var e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e},e.fromValues=function(t,e){var i=new Float32Array(2);return i[0]=t,i[1]=e,i},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},e.set=function(t,e,i){return t[0]=e,t[1]=i,t},e.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},e.sub=e.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},e.mul=e.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},e.div=e.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},e.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},e.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},e.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},e.dist=e.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(i*i+n*n)},e.sqrDist=e.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n},e.len=e.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},e.sqrLen=e.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},e.normalize=function(t,e){var i=e[0],n=e[1],s=i*i+n*n;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s),t},e.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},e.cross=function(t,e,i){var n=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=n,t},e.lerp=function(t,e,i,n){var s=e[0],o=e[1];return t[0]=s+n*(i[0]-s),t[1]=o+n*(i[1]-o),t},e.transformMat2=function(t,e,i){var n=e[0],s=e[1];return t[0]=n*i[0]+s*i[1],t[1]=n*i[2]+s*i[3],t},e.forEach=function(){var t=new Float32Array(2);return function(e,i,n,s,o,r){var a,h;for(i||(i=2),n||(n=0),h=s?Math.min(s*i+n,e.length):e.length,a=n;h>a;a+=i)t[0]=e[a],t[1]=e[a+1],o(t,t,r),e[a]=t[0],e[a+1]=t[1];return e}}(),e.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},"undefined"!=typeof t&&(t.vec2=e);var n={};if(!i)var i=1e-6;n.create=function(){return new Float32Array(3)},n.clone=function(t){var e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},n.fromValues=function(t,e,i){var n=new Float32Array(3);return n[0]=t,n[1]=e,n[2]=i,n},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},n.set=function(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},n.sub=n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t},n.mul=n.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t},n.div=n.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},n.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},n.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},n.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},n.dist=n.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(i*i+n*n+s*s)},n.sqrDist=n.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return i*i+n*n+s*s},n.len=n.length=function(t){var e=t[0],i=t[1],n=t[2];return Math.sqrt(e*e+i*i+n*n)},n.sqrLen=n.squaredLength=function(t){var e=t[0],i=t[1],n=t[2];return e*e+i*i+n*n},n.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},n.normalize=function(t,e){var i=e[0],n=e[1],s=e[2],o=i*i+n*n+s*s;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},n.cross=function(t,e,i){var n=e[0],s=e[1],o=e[2],r=i[0],a=i[1],h=i[2];return t[0]=s*h-o*a,t[1]=o*r-n*h,t[2]=n*a-s*r,t},n.lerp=function(t,e,i,n){var s=e[0],o=e[1],r=e[2];return t[0]=s+n*(i[0]-s),t[1]=o+n*(i[1]-o),t[2]=r+n*(i[2]-r),t},n.transformMat4=function(t,e,i){var n=e[0],s=e[1],o=e[2];return t[0]=i[0]*n+i[4]*s+i[8]*o+i[12],t[1]=i[1]*n+i[5]*s+i[9]*o+i[13],t[2]=i[2]*n+i[6]*s+i[10]*o+i[14],t},n.transformQuat=function(t,e,i){var n=e[0],s=e[1],o=e[2],r=i[0],a=i[1],h=i[2],u=i[3],c=u*n+a*o-h*s,d=u*s+h*n-r*o,l=u*o+r*s-a*n,f=-r*n-a*s-h*o;return t[0]=c*u+f*-r+d*-h-l*-a,t[1]=d*u+f*-a+l*-r-c*-h,t[2]=l*u+f*-h+c*-a-d*-r,t},n.forEach=function(){var t=new Float32Array(3);return function(e,i,n,s,o,r){var a,h;for(i||(i=3),n||(n=0),h=s?Math.min(s*i+n,e.length):e.length,a=n;h>a;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],o(t,t,r),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}}(),n.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},"undefined"!=typeof t&&(t.vec3=n);var s={};if(!i)var i=1e-6;s.create=function(){return new Float32Array(4)},s.clone=function(t){var e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},s.fromValues=function(t,e,i,n){var s=new Float32Array(4);return s[0]=t,s[1]=e,s[2]=i,s[3]=n,s},s.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},s.set=function(t,e,i,n,s){return t[0]=e,t[1]=i,t[2]=n,t[3]=s,t},s.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},s.sub=s.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t},s.mul=s.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t},s.div=s.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t},s.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},s.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},s.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},s.dist=s.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2],o=e[3]-t[3];return Math.sqrt(i*i+n*n+s*s+o*o)},s.sqrDist=s.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2],o=e[3]-t[3];return i*i+n*n+s*s+o*o},s.len=s.length=function(t){var e=t[0],i=t[1],n=t[2],s=t[3];return Math.sqrt(e*e+i*i+n*n+s*s)},s.sqrLen=s.squaredLength=function(t){var e=t[0],i=t[1],n=t[2],s=t[3];return e*e+i*i+n*n+s*s},s.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},s.normalize=function(t,e){var i=e[0],n=e[1],s=e[2],o=e[3],r=i*i+n*n+s*s+o*o;return r>0&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r),t},s.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},s.lerp=function(t,e,i,n){var s=e[0],o=e[1],r=e[2],a=e[3];return t[0]=s+n*(i[0]-s),t[1]=o+n*(i[1]-o),t[2]=r+n*(i[2]-r),t[3]=a+n*(i[3]-a),t},s.transformMat4=function(t,e,i){var n=e[0],s=e[1],o=e[2],r=e[3];return t[0]=i[0]*n+i[4]*s+i[8]*o+i[12]*r,t[1]=i[1]*n+i[5]*s+i[9]*o+i[13]*r,t[2]=i[2]*n+i[6]*s+i[10]*o+i[14]*r,t[3]=i[3]*n+i[7]*s+i[11]*o+i[15]*r,t},s.transformQuat=function(t,e,i){var n=e[0],s=e[1],o=e[2],r=i[0],a=i[1],h=i[2],u=i[3],c=u*n+a*o-h*s,d=u*s+h*n-r*o,l=u*o+r*s-a*n,f=-r*n-a*s-h*o;return t[0]=c*u+f*-r+d*-h-l*-a,t[1]=d*u+f*-a+l*-r-c*-h,t[2]=l*u+f*-h+c*-a-d*-r,t},s.forEach=function(){var t=new Float32Array(4);return function(e,i,n,s,o,r){var a,h;for(i||(i=4),n||(n=0),h=s?Math.min(s*i+n,e.length):e.length,a=n;h>a;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],o(t,t,r),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}(),s.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.vec4=s);var o={},r=new Float32Array([1,0,0,1]);if(!i)var i=1e-6;o.create=function(){return new Float32Array(r)},o.clone=function(t){var e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},o.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},o.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},o.invert=function(t,e){var i=e[0],n=e[1],s=e[2],o=e[3],r=i*o-s*n;return r?(r=1/r,t[0]=o*r,t[1]=-n*r,t[2]=-s*r,t[3]=i*r,t):null},o.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},o.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},o.mul=o.multiply=function(t,e,i){var n=e[0],s=e[1],o=e[2],r=e[3],a=i[0],h=i[1],u=i[2],c=i[3];return t[0]=n*a+s*u,t[1]=n*h+s*c,t[2]=o*a+r*u,t[3]=o*h+r*c,t},o.rotate=function(t,e,i){var n=e[0],s=e[1],o=e[2],r=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h+s*a,t[1]=n*-a+s*h,t[2]=o*h+r*a,t[3]=o*-a+r*h,t},o.scale=function(t,e,i){var n=e[0],s=e[1],o=e[2],r=e[3],a=i[0],h=i[1];return t[0]=n*a,t[1]=s*h,t[2]=o*a,t[3]=r*h,t},o.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.mat2=o);var a={},h=new Float32Array([1,0,0,0,1,0,0,0,1]);if(!i)var i=1e-6;a.create=function(){return new Float32Array(h)},a.clone=function(t){var e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},a.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},a.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},a.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=n,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},a.invert=function(t,e){var i=e[0],n=e[1],s=e[2],o=e[3],r=e[4],a=e[5],h=e[6],u=e[7],c=e[8],d=c*r-a*u,l=-c*o+a*h,f=u*o-r*h,g=i*d+n*l+s*f;return g?(g=1/g,t[0]=d*g,t[1]=(-c*n+s*u)*g,t[2]=(a*n-s*r)*g,t[3]=l*g,t[4]=(c*i-s*h)*g,t[5]=(-a*i+s*o)*g,t[6]=f*g,t[7]=(-u*i+n*h)*g,t[8]=(r*i-n*o)*g,t):null},a.adjoint=function(t,e){var i=e[0],n=e[1],s=e[2],o=e[3],r=e[4],a=e[5],h=e[6],u=e[7],c=e[8];return t[0]=r*c-a*u,t[1]=s*u-n*c,t[2]=n*a-s*r,t[3]=a*h-o*c,t[4]=i*c-s*h,t[5]=s*o-i*a,t[6]=o*u-r*h,t[7]=n*h-i*u,t[8]=i*r-n*o,t},a.determinant=function(t){var e=t[0],i=t[1],n=t[2],s=t[3],o=t[4],r=t[5],a=t[6],h=t[7],u=t[8];return e*(u*o-r*h)+i*(-u*s+r*a)+n*(h*s-o*a)},a.mul=a.multiply=function(t,e,i){var n=e[0],s=e[1],o=e[2],r=e[3],a=e[4],h=e[5],u=e[6],c=e[7],d=e[8],l=i[0],f=i[1],g=i[2],p=i[3],m=i[4],y=i[5],v=i[6],I=i[7],P=i[8];return t[0]=l*n+f*r+g*u,t[1]=l*s+f*a+g*c,t[2]=l*o+f*h+g*d,t[3]=p*n+m*r+y*u,t[4]=p*s+m*a+y*c,t[5]=p*o+m*h+y*d,t[6]=v*n+I*r+P*u,t[7]=v*s+I*a+P*c,t[8]=v*o+I*h+P*d,t},a.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},"undefined"!=typeof t&&(t.mat3=a);var u={},c=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(!i)var i=1e-6;u.create=function(){return new Float32Array(c)},u.clone=function(t){var e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},u.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},u.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},u.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],s=e[3],o=e[6],r=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=s,t[13]=r,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},u.invert=function(t,e){var i=e[0],n=e[1],s=e[2],o=e[3],r=e[4],a=e[5],h=e[6],u=e[7],c=e[8],d=e[9],l=e[10],f=e[11],g=e[12],p=e[13],m=e[14],y=e[15],v=i*a-n*r,I=i*h-s*r,P=i*u-o*r,A=n*h-s*a,w=n*u-o*a,b=s*u-o*h,x=c*p-d*g,W=c*m-l*g,L=c*y-f*g,O=d*m-l*p,M=d*y-f*p,S=l*y-f*m,C=v*S-I*M+P*O+A*L-w*W+b*x;return C?(C=1/C,t[0]=(a*S-h*M+u*O)*C,t[1]=(s*M-n*S-o*O)*C,t[2]=(p*b-m*w+y*A)*C,t[3]=(l*w-d*b-f*A)*C,t[4]=(h*L-r*S-u*W)*C,t[5]=(i*S-s*L+o*W)*C,t[6]=(m*P-g*b-y*I)*C,t[7]=(c*b-l*P+f*I)*C,t[8]=(r*M-a*L+u*x)*C,t[9]=(n*L-i*M-o*x)*C,t[10]=(g*w-p*P+y*v)*C,t[11]=(d*P-c*w-f*v)*C,t[12]=(a*W-r*O-h*x)*C,t[13]=(i*O-n*W+s*x)*C,t[14]=(p*I-g*A-m*v)*C,t[15]=(c*A-d*I+l*v)*C,t):null},u.adjoint=function(t,e){var i=e[0],n=e[1],s=e[2],o=e[3],r=e[4],a=e[5],h=e[6],u=e[7],c=e[8],d=e[9],l=e[10],f=e[11],g=e[12],p=e[13],m=e[14],y=e[15];return t[0]=a*(l*y-f*m)-d*(h*y-u*m)+p*(h*f-u*l),t[1]=-(n*(l*y-f*m)-d*(s*y-o*m)+p*(s*f-o*l)),t[2]=n*(h*y-u*m)-a*(s*y-o*m)+p*(s*u-o*h),t[3]=-(n*(h*f-u*l)-a*(s*f-o*l)+d*(s*u-o*h)),t[4]=-(r*(l*y-f*m)-c*(h*y-u*m)+g*(h*f-u*l)),t[5]=i*(l*y-f*m)-c*(s*y-o*m)+g*(s*f-o*l),t[6]=-(i*(h*y-u*m)-r*(s*y-o*m)+g*(s*u-o*h)),t[7]=i*(h*f-u*l)-r*(s*f-o*l)+c*(s*u-o*h),t[8]=r*(d*y-f*p)-c*(a*y-u*p)+g*(a*f-u*d),t[9]=-(i*(d*y-f*p)-c*(n*y-o*p)+g*(n*f-o*d)),t[10]=i*(a*y-u*p)-r*(n*y-o*p)+g*(n*u-o*a),t[11]=-(i*(a*f-u*d)-r*(n*f-o*d)+c*(n*u-o*a)),t[12]=-(r*(d*m-l*p)-c*(a*m-h*p)+g*(a*l-h*d)),t[13]=i*(d*m-l*p)-c*(n*m-s*p)+g*(n*l-s*d),t[14]=-(i*(a*m-h*p)-r*(n*m-s*p)+g*(n*h-s*a)),t[15]=i*(a*l-h*d)-r*(n*l-s*d)+c*(n*h-s*a),t},u.determinant=function(t){var e=t[0],i=t[1],n=t[2],s=t[3],o=t[4],r=t[5],a=t[6],h=t[7],u=t[8],c=t[9],d=t[10],l=t[11],f=t[12],g=t[13],p=t[14],m=t[15],y=e*r-i*o,v=e*a-n*o,I=e*h-s*o,P=i*a-n*r,A=i*h-s*r,w=n*h-s*a,b=u*g-c*f,x=u*p-d*f,W=u*m-l*f,L=c*p-d*g,O=c*m-l*g,M=d*m-l*p;return y*M-v*O+I*L+P*W-A*x+w*b},u.mul=u.multiply=function(t,e,i){var n=e[0],s=e[1],o=e[2],r=e[3],a=e[4],h=e[5],u=e[6],c=e[7],d=e[8],l=e[9],f=e[10],g=e[11],p=e[12],m=e[13],y=e[14],v=e[15],I=i[0],P=i[1],A=i[2],w=i[3];return t[0]=I*n+P*a+A*d+w*p,t[1]=I*s+P*h+A*l+w*m,t[2]=I*o+P*u+A*f+w*y,t[3]=I*r+P*c+A*g+w*v,I=i[4],P=i[5],A=i[6],w=i[7],t[4]=I*n+P*a+A*d+w*p,t[5]=I*s+P*h+A*l+w*m,t[6]=I*o+P*u+A*f+w*y,t[7]=I*r+P*c+A*g+w*v,I=i[8],P=i[9],A=i[10],w=i[11],t[8]=I*n+P*a+A*d+w*p,t[9]=I*s+P*h+A*l+w*m,t[10]=I*o+P*u+A*f+w*y,t[11]=I*r+P*c+A*g+w*v,I=i[12],P=i[13],A=i[14],w=i[15],t[12]=I*n+P*a+A*d+w*p,t[13]=I*s+P*h+A*l+w*m,t[14]=I*o+P*u+A*f+w*y,t[15]=I*r+P*c+A*g+w*v,t},u.translate=function(t,e,i){var n,s,o,r,a,h,u,c,d,l,f,g,p=i[0],m=i[1],y=i[2];return e===t?(t[12]=e[0]*p+e[4]*m+e[8]*y+e[12],t[13]=e[1]*p+e[5]*m+e[9]*y+e[13],t[14]=e[2]*p+e[6]*m+e[10]*y+e[14],t[15]=e[3]*p+e[7]*m+e[11]*y+e[15]):(n=e[0],s=e[1],o=e[2],r=e[3],a=e[4],h=e[5],u=e[6],c=e[7],d=e[8],l=e[9],f=e[10],g=e[11],t[0]=n,t[1]=s,t[2]=o,t[3]=r,t[4]=a,t[5]=h,t[6]=u,t[7]=c,t[8]=d,t[9]=l,t[10]=f,t[11]=g,t[12]=n*p+a*m+d*y+e[12],t[13]=s*p+h*m+l*y+e[13],t[14]=o*p+u*m+f*y+e[14],t[15]=r*p+c*m+g*y+e[15]),t},u.scale=function(t,e,i){var n=i[0],s=i[1],o=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},u.rotate=function(t,e,n,s){var o,r,a,h,u,c,d,l,f,g,p,m,y,v,I,P,A,w,b,x,W,L,O,M,S=s[0],C=s[1],R=s[2],T=Math.sqrt(S*S+C*C+R*R);return Math.abs(T)<i?null:(T=1/T,S*=T,C*=T,R*=T,o=Math.sin(n),r=Math.cos(n),a=1-r,h=e[0],u=e[1],c=e[2],d=e[3],l=e[4],f=e[5],g=e[6],p=e[7],m=e[8],y=e[9],v=e[10],I=e[11],P=S*S*a+r,A=C*S*a+R*o,w=R*S*a-C*o,b=S*C*a-R*o,x=C*C*a+r,W=R*C*a+S*o,L=S*R*a+C*o,O=C*R*a-S*o,M=R*R*a+r,t[0]=h*P+l*A+m*w,t[1]=u*P+f*A+y*w,t[2]=c*P+g*A+v*w,t[3]=d*P+p*A+I*w,t[4]=h*b+l*x+m*W,t[5]=u*b+f*x+y*W,t[6]=c*b+g*x+v*W,t[7]=d*b+p*x+I*W,t[8]=h*L+l*O+m*M,t[9]=u*L+f*O+y*M,t[10]=c*L+g*O+v*M,t[11]=d*L+p*O+I*M,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},u.rotateX=function(t,e,i){
var n=Math.sin(i),s=Math.cos(i),o=e[4],r=e[5],a=e[6],h=e[7],u=e[8],c=e[9],d=e[10],l=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*s+u*n,t[5]=r*s+c*n,t[6]=a*s+d*n,t[7]=h*s+l*n,t[8]=u*s-o*n,t[9]=c*s-r*n,t[10]=d*s-a*n,t[11]=l*s-h*n,t},u.rotateY=function(t,e,i){var n=Math.sin(i),s=Math.cos(i),o=e[0],r=e[1],a=e[2],h=e[3],u=e[8],c=e[9],d=e[10],l=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*s-u*n,t[1]=r*s-c*n,t[2]=a*s-d*n,t[3]=h*s-l*n,t[8]=o*n+u*s,t[9]=r*n+c*s,t[10]=a*n+d*s,t[11]=h*n+l*s,t},u.rotateZ=function(t,e,i){var n=Math.sin(i),s=Math.cos(i),o=e[0],r=e[1],a=e[2],h=e[3],u=e[4],c=e[5],d=e[6],l=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*s+u*n,t[1]=r*s+c*n,t[2]=a*s+d*n,t[3]=h*s+l*n,t[4]=u*s-o*n,t[5]=c*s-r*n,t[6]=d*s-a*n,t[7]=l*s-h*n,t},u.fromRotationTranslation=function(t,e,i){var n=e[0],s=e[1],o=e[2],r=e[3],a=n+n,h=s+s,u=o+o,c=n*a,d=n*h,l=n*u,f=s*h,g=s*u,p=o*u,m=r*a,y=r*h,v=r*u;return t[0]=1-(f+p),t[1]=d+v,t[2]=l-y,t[3]=0,t[4]=d-v,t[5]=1-(c+p),t[6]=g+m,t[7]=0,t[8]=l+y,t[9]=g-m,t[10]=1-(c+f),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},u.frustum=function(t,e,i,n,s,o,r){var a=1/(i-e),h=1/(s-n),u=1/(o-r);return t[0]=2*o*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*h,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(s+n)*h,t[10]=(r+o)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=r*o*2*u,t[15]=0,t},u.perspective=function(t,e,i,n,s){var o=1/Math.tan(e/2),r=1/(n-s);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(s+n)*r,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*s*n*r,t[15]=0,t},u.ortho=function(t,e,i,n,s,o,r){var a=1/(e-i),h=1/(n-s),u=1/(o-r);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+i)*a,t[13]=(s+n)*h,t[14]=(r+o)*u,t[15]=1,t},u.lookAt=function(t,e,n,s){var o,r,a,h,c,d,l,f,g,p,m=e[0],y=e[1],v=e[2],I=s[0],P=s[1],A=s[2],w=n[0],b=n[1],x=n[2];return Math.abs(m-w)<i&&Math.abs(y-b)<i&&Math.abs(v-x)<i?u.identity(t):(l=m-w,f=y-b,g=v-x,p=1/Math.sqrt(l*l+f*f+g*g),l*=p,f*=p,g*=p,o=P*g-A*f,r=A*l-I*g,a=I*f-P*l,p=Math.sqrt(o*o+r*r+a*a),p?(p=1/p,o*=p,r*=p,a*=p):(o=0,r=0,a=0),h=f*a-g*r,c=g*o-l*a,d=l*r-f*o,p=Math.sqrt(h*h+c*c+d*d),p?(p=1/p,h*=p,c*=p,d*=p):(h=0,c=0,d=0),t[0]=o,t[1]=h,t[2]=l,t[3]=0,t[4]=r,t[5]=c,t[6]=f,t[7]=0,t[8]=a,t[9]=d,t[10]=g,t[11]=0,t[12]=-(o*m+r*y+a*v),t[13]=-(h*m+c*y+d*v),t[14]=-(l*m+f*y+g*v),t[15]=1,t)},u.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},"undefined"!=typeof t&&(t.mat4=u);var d={},l=new Float32Array([0,0,0,1]);if(!i)var i=1e-6;d.create=function(){return new Float32Array(l)},d.clone=s.clone,d.fromValues=s.fromValues,d.copy=s.copy,d.set=s.set,d.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},d.setAxisAngle=function(t,e,i){i=.5*i;var n=Math.sin(i);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i),t},d.add=s.add,d.mul=d.multiply=function(t,e,i){var n=e[0],s=e[1],o=e[2],r=e[3],a=i[0],h=i[1],u=i[2],c=i[3];return t[0]=n*c+r*a+s*u-o*h,t[1]=s*c+r*h+o*a-n*u,t[2]=o*c+r*u+n*h-s*a,t[3]=r*c-n*a-s*h-o*u,t},d.scale=s.scale,d.rotateX=function(t,e,i){i*=.5;var n=e[0],s=e[1],o=e[2],r=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h+r*a,t[1]=s*h+o*a,t[2]=o*h-s*a,t[3]=r*h-n*a,t},d.rotateY=function(t,e,i){i*=.5;var n=e[0],s=e[1],o=e[2],r=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h-o*a,t[1]=s*h+r*a,t[2]=o*h+n*a,t[3]=r*h-s*a,t},d.rotateZ=function(t,e,i){i*=.5;var n=e[0],s=e[1],o=e[2],r=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h+s*a,t[1]=s*h-n*a,t[2]=o*h+r*a,t[3]=r*h-o*a,t},d.calculateW=function(t,e){var i=e[0],n=e[1],s=e[2];return t[0]=i,t[1]=n,t[2]=s,t[3]=-Math.sqrt(Math.abs(1-i*i-n*n-s*s)),t},d.dot=s.dot,d.lerp=s.lerp,d.slerp=function(t,e,i,n){var s,o,r,a,h=e[0],u=e[1],c=e[2],d=e[3],l=i[0],f=i[1],g=i[2],p=e[3],m=h*l+u*f+c*g+d*p;return Math.abs(m)>=1?(t!==e&&(t[0]=h,t[1]=u,t[2]=c,t[3]=d),t):(s=Math.acos(m),o=Math.sqrt(1-m*m),Math.abs(o)<.001?(t[0]=.5*h+.5*l,t[1]=.5*u+.5*f,t[2]=.5*c+.5*g,t[3]=.5*d+.5*p,t):(r=Math.sin((1-n)*s)/o,a=Math.sin(n*s)/o,t[0]=h*r+l*a,t[1]=u*r+f*a,t[2]=c*r+g*a,t[3]=d*r+p*a,t))},d.invert=function(t,e){var i=e[0],n=e[1],s=e[2],o=e[3],r=i*i+n*n+s*s+o*o,a=r?1/r:0;return t[0]=-i*a,t[1]=-n*a,t[2]=-s*a,t[3]=o*a,t},d.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},d.len=d.length=s.length,d.sqrLen=d.squaredLength=s.squaredLength,d.normalize=s.normalize,d.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.quat=d)}(t.exports)}();var WayfinderAPI={LOCATION:"//api.3dwayfinder.com/",PROJECT:!1,getJSON:function(t,e){Logistics.getJSON(t,e).error(function(t){console&&console.log&&console.log("Failed to get JSON: "+JSON.stringify(t))})},getURL:function(t,e,i){if(WayfinderAPI.PROJECT===!1)throw"No project opened! Call WayfinderAPI.open(<project name>);";return i=i||[],[WayfinderAPI.LOCATION,"public",WayfinderAPI.PROJECT,t,e].concat(i).join("/")},open:function(t){WayfinderAPI.PROJECT=t}};WayfinderAPI["2d"]={},WayfinderAPI["3d"]={},WayfinderAPI.access={},WayfinderAPI.advertisements={},WayfinderAPI.building={},WayfinderAPI.guitranslations={},WayfinderAPI.images={},WayfinderAPI.languages={},WayfinderAPI.lights={},WayfinderAPI.locationgroups={},WayfinderAPI.locations={},WayfinderAPI.materials={},WayfinderAPI.models={},WayfinderAPI.navigation={},WayfinderAPI.poisettings={},WayfinderAPI.settings={},WayfinderAPI.statistics={},WayfinderAPI.templates={},WayfinderAPI.textures={},WayfinderAPI["2d"].edges=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","edges",[]),t)},WayfinderAPI["2d"].edges.url=function(){return WayfinderAPI.getURL("2d","edges",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].image=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","image",[t]),e)},WayfinderAPI["2d"].image.url=function(){return WayfinderAPI.getURL("2d","image",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].lod=function(t,e,i,n,s){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","lod",[t,e,i,n]),s)},WayfinderAPI["2d"].lod.url=function(){return WayfinderAPI.getURL("2d","lod",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].lodcount=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","lodcount",[]),t)},WayfinderAPI["2d"].lodcount.url=function(){return WayfinderAPI.getURL("2d","lodcount",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].nodes=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","nodes",[]),t)},WayfinderAPI["2d"].nodes.url=function(){return WayfinderAPI.getURL("2d","nodes",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].overlays=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","overlays",[]),t)},WayfinderAPI["2d"].overlays.url=function(){return WayfinderAPI.getURL("2d","overlays",Array.prototype.slice.call(arguments,0))},WayfinderAPI["3d"].scene=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("3d","scene",[]),t)},WayfinderAPI["3d"].scene.url=function(){return WayfinderAPI.getURL("3d","scene",Array.prototype.slice.call(arguments,0))},WayfinderAPI.access.template=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("access","template",[t]),e)},WayfinderAPI.access.template.url=function(){return WayfinderAPI.getURL("access","template",Array.prototype.slice.call(arguments,0))},WayfinderAPI.advertisements.all=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("advertisements","all",[]),t)},WayfinderAPI.advertisements.all.url=function(){return WayfinderAPI.getURL("advertisements","all",Array.prototype.slice.call(arguments,0))},WayfinderAPI.advertisements.data=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("advertisements","data",[t]),e)},WayfinderAPI.advertisements.data.url=function(){return WayfinderAPI.getURL("advertisements","data",Array.prototype.slice.call(arguments,0))},WayfinderAPI.advertisements.frames=function(t,e,i,n){WayfinderAPI.getJSON(WayfinderAPI.getURL("advertisements","frames",[t,e,i]),n)},WayfinderAPI.advertisements.frames.url=function(){return WayfinderAPI.getURL("advertisements","frames",Array.prototype.slice.call(arguments,0))},WayfinderAPI.building.levels=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("building","levels",[]),t)},WayfinderAPI.building.levels.url=function(){return WayfinderAPI.getURL("building","levels",Array.prototype.slice.call(arguments,0))},WayfinderAPI.building.location=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("building","location",[]),t)},WayfinderAPI.building.location.url=function(){return WayfinderAPI.getURL("building","location",Array.prototype.slice.call(arguments,0))},WayfinderAPI.guitranslations.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("guitranslations","get",[]),t)},WayfinderAPI.guitranslations.get.url=function(){return WayfinderAPI.getURL("guitranslations","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.images.checkImage=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("images","checkImage",[t]),e)},WayfinderAPI.images.checkImage.url=function(){return WayfinderAPI.getURL("images","checkImage",Array.prototype.slice.call(arguments,0))},WayfinderAPI.images.get=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("images","get",[t]),e)},WayfinderAPI.images.get.url=function(){return WayfinderAPI.getURL("images","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.images.thumbnail=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("images","thumbnail",[t]),e)},WayfinderAPI.images.thumbnail.url=function(){return WayfinderAPI.getURL("images","thumbnail",Array.prototype.slice.call(arguments,0))},WayfinderAPI.languages.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("languages","get",[]),t)},WayfinderAPI.languages.get.url=function(){return WayfinderAPI.getURL("languages","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.languages.translation=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("languages","translation",[t]),e)},WayfinderAPI.languages.translation.url=function(){return WayfinderAPI.getURL("languages","translation",Array.prototype.slice.call(arguments,0))},WayfinderAPI.lights.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("lights","get",[]),t)},WayfinderAPI.lights.get.url=function(){return WayfinderAPI.getURL("lights","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locationgroups.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("locationgroups","get",[]),t)},WayfinderAPI.locationgroups.get.url=function(){return WayfinderAPI.getURL("locationgroups","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locations.byfloor=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("locations","byfloor",[]),t)},WayfinderAPI.locations.byfloor.url=function(){return WayfinderAPI.getURL("locations","byfloor",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locations.bygroup=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("locations","bygroup",[]),t)},WayfinderAPI.locations.bygroup.url=function(){return WayfinderAPI.getURL("locations","bygroup",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locations.bynode=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("locations","bynode",[t]),e)},WayfinderAPI.locations.bynode.url=function(){return WayfinderAPI.getURL("locations","bynode",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locations.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("locations","get",[]),t)},WayfinderAPI.locations.get.url=function(){return WayfinderAPI.getURL("locations","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locations.location=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("locations","location",[t]),e)},WayfinderAPI.locations.location.url=function(){return WayfinderAPI.getURL("locations","location",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locations.tags=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("locations","tags",[]),t)},WayfinderAPI.locations.tags.url=function(){return WayfinderAPI.getURL("locations","tags",Array.prototype.slice.call(arguments,0))},WayfinderAPI.materials.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("materials","get",[]),t)},WayfinderAPI.materials.get.url=function(){return WayfinderAPI.getURL("materials","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.materials.textureMaterialNames=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("materials","textureMaterialNames",[t]),e)},WayfinderAPI.materials.textureMaterialNames.url=function(){return WayfinderAPI.getURL("materials","textureMaterialNames",Array.prototype.slice.call(arguments,0))},WayfinderAPI.materials.textures=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("materials","textures",[t]),e)},WayfinderAPI.materials.textures.url=function(){return WayfinderAPI.getURL("materials","textures",Array.prototype.slice.call(arguments,0))},WayfinderAPI.materials.uniforms=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("materials","uniforms",[t]),e)},WayfinderAPI.materials.uniforms.url=function(){return WayfinderAPI.getURL("materials","uniforms",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.all=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","all",[]),t)},WayfinderAPI.models.all.url=function(){return WayfinderAPI.getURL("models","all",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.allmeshes=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","allmeshes",[]),t)},WayfinderAPI.models.allmeshes.url=function(){return WayfinderAPI.getURL("models","allmeshes",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","get",[]),t)},WayfinderAPI.models.get.url=function(){return WayfinderAPI.getURL("models","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.instances=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","instances",[]),t)},WayfinderAPI.models.instances.url=function(){return WayfinderAPI.getURL("models","instances",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.json=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","json",[t]),e)},WayfinderAPI.models.json.url=function(){return WayfinderAPI.getURL("models","json",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.meshes=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","meshes",[t]),e)},WayfinderAPI.models.meshes.url=function(){return WayfinderAPI.getURL("models","meshes",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.meshesbyfloor=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","meshesbyfloor",[]),t)},WayfinderAPI.models.meshesbyfloor.url=function(){return WayfinderAPI.getURL("models","meshesbyfloor",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.model=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","model",[t]),e)},WayfinderAPI.models.model.url=function(){return WayfinderAPI.getURL("models","model",Array.prototype.slice.call(arguments,0))},WayfinderAPI.navigation.allAttributes=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("navigation","allAttributes",[]),t)},WayfinderAPI.navigation.allAttributes.url=function(){return WayfinderAPI.getURL("navigation","allAttributes",Array.prototype.slice.call(arguments,0))},WayfinderAPI.navigation.attributes=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("navigation","attributes",[t]),e)},WayfinderAPI.navigation.attributes.url=function(){return WayfinderAPI.getURL("navigation","attributes",Array.prototype.slice.call(arguments,0))},WayfinderAPI.navigation.edges=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("navigation","edges",[]),t)},WayfinderAPI.navigation.edges.url=function(){return WayfinderAPI.getURL("navigation","edges",Array.prototype.slice.call(arguments,0))},WayfinderAPI.navigation.node=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("navigation","node",[t]),e)},WayfinderAPI.navigation.node.url=function(){return WayfinderAPI.getURL("navigation","node",Array.prototype.slice.call(arguments,0))},WayfinderAPI.navigation.nodes=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("navigation","nodes",[]),t)},WayfinderAPI.navigation.nodes.url=function(){return WayfinderAPI.getURL("navigation","nodes",Array.prototype.slice.call(arguments,0))},WayfinderAPI.navigation.nodesbytype=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("navigation","nodesbytype",[t]),e)},WayfinderAPI.navigation.nodesbytype.url=function(){return WayfinderAPI.getURL("navigation","nodesbytype",Array.prototype.slice.call(arguments,0))},WayfinderAPI.poisettings.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("poisettings","get",[]),t)},WayfinderAPI.poisettings.get.url=function(){return WayfinderAPI.getURL("poisettings","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.poisettings.getAllPOISettings=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("poisettings","getAllPOISettings",[]),t)},WayfinderAPI.poisettings.getAllPOISettings.url=function(){return WayfinderAPI.getURL("poisettings","getAllPOISettings",Array.prototype.slice.call(arguments,0))},WayfinderAPI.poisettings.map=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("poisettings","map",[]),t)},WayfinderAPI.poisettings.map.url=function(){return WayfinderAPI.getURL("poisettings","map",Array.prototype.slice.call(arguments,0))},WayfinderAPI.poisettings.setting=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("poisettings","setting",[t]),e)},WayfinderAPI.poisettings.setting.url=function(){return WayfinderAPI.getURL("poisettings","setting",Array.prototype.slice.call(arguments,0))},WayfinderAPI.settings.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("settings","get",[]),t)},WayfinderAPI.settings.get.url=function(){return WayfinderAPI.getURL("settings","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.settings.map=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("settings","map",[]),t)},WayfinderAPI.settings.map.url=function(){return WayfinderAPI.getURL("settings","map",Array.prototype.slice.call(arguments,0))},WayfinderAPI.settings.setting=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("settings","setting",[t]),e)},WayfinderAPI.settings.setting.url=function(){return WayfinderAPI.getURL("settings","setting",Array.prototype.slice.call(arguments,0))},WayfinderAPI.statistics.click=function(t,e,i,n){WayfinderAPI.getJSON(WayfinderAPI.getURL("statistics","click",[t,e,i]),n)},WayfinderAPI.statistics.click.url=function(){return WayfinderAPI.getURL("statistics","click",Array.prototype.slice.call(arguments,0))},WayfinderAPI.statistics.device=function(t,e,i,n){WayfinderAPI.getJSON(WayfinderAPI.getURL("statistics","device",[t,e,i]),n)},WayfinderAPI.statistics.device.url=function(){return WayfinderAPI.getURL("statistics","device",Array.prototype.slice.call(arguments,0))},WayfinderAPI.statistics.endSession=function(t,e,i){WayfinderAPI.getJSON(WayfinderAPI.getURL("statistics","endSession",[t,e]),i)},WayfinderAPI.statistics.endSession.url=function(){return WayfinderAPI.getURL("statistics","endSession",Array.prototype.slice.call(arguments,0))},WayfinderAPI.statistics.search=function(t,e,i,n){WayfinderAPI.getJSON(WayfinderAPI.getURL("statistics","search",[t,e,i]),n)},WayfinderAPI.statistics.search.url=function(){return WayfinderAPI.getURL("statistics","search",Array.prototype.slice.call(arguments,0))},WayfinderAPI.statistics.startSession=function(t,e,i,n,s,o){WayfinderAPI.getJSON(WayfinderAPI.getURL("statistics","startSession",[t,e,i,n,s]),o)},WayfinderAPI.statistics.startSession.url=function(){return WayfinderAPI.getURL("statistics","startSession",Array.prototype.slice.call(arguments,0))},WayfinderAPI.templates.css=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("templates","css",[t]),e)},WayfinderAPI.templates.css.url=function(){return WayfinderAPI.getURL("templates","css",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.count=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","count",[]),t)},WayfinderAPI.textures.count.url=function(){return WayfinderAPI.getURL("textures","count",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.map=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","map",[]),t)},WayfinderAPI.textures.map.url=function(){return WayfinderAPI.getURL("textures","map",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.mipmap=function(t,e,i){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","mipmap",[t,e]),i)},WayfinderAPI.textures.mipmap.url=function(){return WayfinderAPI.getURL("textures","mipmap",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.names=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","names",[]),t)},WayfinderAPI.textures.names.url=function(){return WayfinderAPI.getURL("textures","names",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.texture=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","texture",[t]),e)},WayfinderAPI.textures.texture.url=function(){return WayfinderAPI.getURL("textures","texture",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.texturebyid=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","texturebyid",[t]),e)},WayfinderAPI.textures.texturebyid.url=function(){return WayfinderAPI.getURL("textures","texturebyid",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.thumbnail=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","thumbnail",[t]),e)},WayfinderAPI.textures.thumbnail.url=function(){return WayfinderAPI.getURL("textures","thumbnail",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.thumbnailbyid=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","thumbnailbyid",[t]),e)},WayfinderAPI.textures.thumbnailbyid.url=function(){return WayfinderAPI.getURL("textures","thumbnailbyid",Array.prototype.slice.call(arguments,0))};var Loader=Class.extend({init:function(t,e,i){this.url=t,this.callback=e,this.userdata=i,this.data=!1,this.loaded=!1,this.id=!1},isLoaded:function(){return this.loaded},load:function(){}}),JSONLoader=Loader.extend({init:function(t,e,i){this._super(t,e,i)},load:function(){var t=this;Logistics.getJSON(this.url,function(e){t.loaded=!0,t.data=e,t.callback&&"function"==typeof t.callback&&t.callback(t.data,t.userdata,t)}).error(function(e,i){console.log("JSONLoader: '"+t.url+"' loading failed ("+i+")."),t.callback&&"function"==typeof t.callback&&t.callback(t.data,t.userdata,t)})}}),ImageLoader=Loader.extend({init:function(t,e,i){this._super(t,e,i)},load:function(){var t=this;Logistics.getImage(this.url,function(e){t.data=e,t.loaded=!0,t.callback&&"function"==typeof t.callback&&t.callback(t.data,t.userdata,t)}).error(function(){t.callback&&"function"==typeof t.callback&&t.callback(!1,t.userdata,t)})}}),HTMLLoader=Loader.extend({init:function(t,e,i){this._super(t,e,i)},load:function(){var t=this;$.get(this.url,function(e){t.loaded=!0,t.data=e,t.callback&&"function"==typeof t.callback&&t.callback(t.data,t.userdata,t)},"html").error(function(e,i){console.log("JSONLoader: '"+t.url+"' loading failed ("+i+")."),t.callback&&"function"==typeof t.callback&&t.callback(t.data,t.userdata,t)})}}),WayfinderData=Class.extend({init:function(t,e){this.items={},this.complete=0,this.count=0,this.loading=!1,this.finished=!1,this.cbFinished=t,this.cbProgress=e,this.resourcesAdded=!1},load:function(){this.complete=0,this.loading=!0;for(var t in this.items)this.items[t].load()},endQueue:function(){this.resourcesAdded=!0},addJSON:function(t,e,i){this.count++,this.items[t]=new JSONLoader(e,ClassCallback(this,this.onResourceLoaded),i),this.items[t].id=t,this.loading&&this.items[t].load()},addImage:function(t,e,i){this.count++,this.items[t]=new ImageLoader(e,ClassCallback(this,this.onResourceLoaded),i),this.items[t].id=t,this.loading&&this.items[t].load()},addHTML:function(t,e,i){this.count++,this.items[t]=new HTMLLoader(e,ClassCallback(this,this.onResourceLoaded),i),this.items[t].id=t,this.loading&&this.items[t].load()},get:function(t){return t in this.items&&this.items[t].isLoaded()?this.items[t].data:!1},exists:function(t){return t in this.items?!0:!1},isLoaded:function(t){return t in this.items?this.items[t].isLoaded():!1},getItemCount:function(){return this.count},onResourceLoaded:function(t,e){this.complete++,this.getItemCount()>0&&!this.finished&&this.cbProgress&&"function"==typeof this.cbProgress&&this.cbProgress(100*this.complete/this.getItemCount()),e&&"function"==typeof e&&t!==!1&&e(t),!this.finished&&this.getItemCount()==this.complete&&this.cbFinished&&"function"==typeof this.cbFinished&&(this.finished=!0,this.cbFinished(this))}}),WayfinderOptions=Class.extend({init:function(){this.application="wayfinder",this.map="map",this.project="demo",this.kiosk=!1,this.debugLog=!1,this.debugPOIs=!1,this.debugTranslations=!1,this.drawKioskIcon=!0,this.apiLocation="../../api/",this.language="en",this.disablePathDrawing=!1,this.searchScroreLimiter=3,this.searchMinimumScrore=10,this.filterPOIs="",this.factory=new WayfinderFactory},loadFromURL:function(){if(location.hash.length>=2){var t=unescape(location.hash.substring(1)).split("#");if(t.length>=1){var e=JSON.parse(t[0]);for(var i in e)log("Overriding option: "+i+"="+e[i]),this[i]=e[i],"kiosk"===i&&(this["kiosk.default"]=e[i])}}}}),Wayfinder=Class.extend({init:function(t,e){t&&t instanceof WayfinderOptions||(t=new WayfinderOptions),e||(e=new WayfinderFactory(this)),this.factory=e,this.setOptions(t),this.settings=new Settings,this.statistics=new WFStatistics(this),this.firstFinishedLoading=!1,this.debugLog=!1,this.kiosk=!1,t.debugLog&&DebugLog&&"DebugLog"==typeof DebugLog&&(this.debugLog=new DebugLog(t.debugLog)),Logistics.onStageProgress(ClassCallback(this,this.onStageProgress)),Logistics.onProgress(ClassCallback(this,this.onProgress)),this.languages={},this.pois={},this.poisArray=[],this.poiGroups={},this.nodes={},this.edges={},this.attributes={},this.poisettings=new Settings,this.poiAdvertisements={},this.advertisements={},this.translator=new Translator(this.options.language,{}),this.building=null,this.firstLanguageChange=!0,this.accessibility=""},cbOnPOIClick:function(){},cbOnDataLoaded:function(){},cbOnProgress:function(){},cbOnStageProgress:function(){},cbOnLanguageChange:function(){},cbOnBeforeFloorChange:function(){},cbOnFloorChange:function(){},cbOnZoomChange:function(){},cbOnPathStep:function(){},cbOnPathFinished:function(){},cbOnTouch:function(){},cbOnMapUpdate:function(){},cbOnMapReady:function(){},finishedLoading:function(){this.firstFinishedLoading||(this.firstFinishedLoading=!0,this.onDataLoaded())},setOptions:function(t){this.options=t,this.options.project=this.readProjectName(),this.options.loadFromURL()},setStyle:function(t){$("head").append('<link rel="stylesheet" type="text/css" href="{0}">'.format(WayfinderAPI.templates.css.url(t)))},open:function(t){"undefined"!=typeof t&&(this.options.project=t),WayfinderAPI.open(this.options.project),this.startLoading(),log("Open",this.options.project)},readProjectName:function(){for(var t=document.location.pathname,e=t.split("/"),i=0;i<e.length;i++)if("projects"==e[i]&&e.length>i+1)return e[i+1];return this.options.project},getLayout:function(){for(var t=document.location.pathname,e=t.split("/"),i=0;i<e.length;i++)if("projects"==e[i]&&e.length>i+2)return e[i+2];return"default"},log:function(){this.debugLog&&this.debugLog.logArray(this.log.arguments)},getProject:function(){return this.options.project},getAPILocation:function(){return WayfinderAPI&&WayfinderAPI.LOCATION?WayfinderAPI.LOCATION:this.options.apiLocation},setKiosk:function(t){this.options.kiosk=t},getKiosk:function(){return this.options.kiosk},getKioskNode:function(){return this.options.kiosk&&this.options.kiosk in this.nodes?this.nodes[this.options.kiosk]:!1},showPath:function(){},showKiosk:function(){},showFloor:function(t){this.cbOnFloorChange&&"function"==typeof this.cbOnFloorChange&&this.cbOnFloorChange(t)},getLanguage:function(){return this.translator.getLanguage()},setLanguage:function(t){this.translator.translate(t),"function"==typeof this.cbOnLanguageChange&&this.cbOnLanguageChange(t)},startLoading:function(){Logistics.getJSON(WayfinderAPI.getURL("settings","get",[]),null,ClassCallback(this,this.onSettingsLoaded),{stage:"settings"}),Logistics.getJSON(WayfinderAPI.getURL("poisettings","getAllPOISettings",[]),null,ClassCallback(this,this.onPOISettingsLoaded),{stage:"settings"}),Logistics.getJSON(WayfinderAPI.getURL("languages","get",[]),null,ClassCallback(this,this.onLanguagesLoaded),{stage:"settings"})},loadPOIIcons:function(){if(this.pois){var t=null;for(var e in this.pois)this.pois[e].image_id&&0!==this.pois[e].image_id&&this.pois[e].alwaysVisible&&(t=Logistics.getImage(WayfinderAPI.getURL("images","get",[this.pois[e].image_id]),null,ClassCallback(this.pois[e],this.pois[e].setIcon),{stage:"locations"}))}},loadSecondaryResources:function(){function t(){e.loadHiddenPOIIcons()}var e=this;setTimeout(t,1e3)},loadHiddenPOIIcons:function(){if(this.pois)for(var t in this.pois)this.pois[t].image_id&&0!==this.pois[t].image_id&&!this.pois[t].alwaysVisible&&Logistics.getImage(WayfinderAPI.getURL("images","thumbnail",[this.pois[t].image_id]),ClassCallback(this.pois[t],this.pois[t].setIcon))},onAdvertisementsLoaded:function(t){this.advertisements=t.data},onSettingsLoaded:function(t){t.data&&(this.settings.data=t.data,this.building=this.factory.createBuilding(this.settings.data),this.settings.data["language.default"]&&(this.options.language=this.settings.data["language.default"],this.setLanguage(this.options.language)),this.settings.data["kiosk.default"]&&(this.setKiosk(this.settings.getInt("kiosk.default",0)),log("setKiosk",this.options.kiosk)),this.options.loadFromURL())},onPOISettingsLoaded:function(t){t.data&&(this.poisettings.data=t.data,this.options.loadFromURL())},onLanguagesLoaded:function(t){if(t.data){var e=t.data;for(var i in e)this.languages[i]=new Language(e[i],e),i.toLowerCase()==this.options.language.toLowerCase()&&(this.translator.language=i);this.translator.translate(),Logistics.getJSON(WayfinderAPI.getURL("guitranslations","get",[]),null,ClassCallback(this,this.createTranslations),{stage:"settings"}),Logistics.getJSON(WayfinderAPI.getURL("building","levels",[]),null,ClassCallback(this,this.onFloorsLoaded),{stage:"settings"})}},onFloorsLoaded:function(t){var e=t.data;this.factory.createFloors(e),Logistics.getMultiple({nodes:{url:WayfinderAPI.getURL("navigation","nodes",[]),type:"json"},attributes:{url:WayfinderAPI.getURL("navigation","allAttributes",[]),type:"json"},pois:{url:WayfinderAPI.getURL("locations","get",[]),type:"json"},floor_pois:{url:WayfinderAPI.getURL("locations","byfloor",[]),type:"json"},edges:{url:WayfinderAPI.getURL("navigation","edges",[]),type:"json"}},ClassCallback(this,this.onPOIsLoaded),{stage:"settings"})},onPOIsLoaded:function(t){var e=t.nodes.data,i=t.attributes,n=t.pois.data,s=t.floor_pois.data,o=t.edges.data;Logistics.getMultiple({groups:{url:WayfinderAPI.getURL("locationgroups","get",[]),type:"json"},pois_in_groups:{url:WayfinderAPI.getURL("locations","bygroup",[]),type:"json"},tags:{url:WayfinderAPI.getURL("locations","tags",[]),type:"json"}},ClassCallback(this,this.onTextDataLoaded),{stage:"locations"}),Logistics.getJSON(WayfinderAPI.advertisements.all.url(),ClassCallback(this,this.onAdvertisementsLoaded)),this.factory.createNodes(e),this.factory.createAttributes(i),this.factory.createPOIs(n),this.factory.createEdges(o),this.factory.addPOIsToFloor(s)},onTextDataLoaded:function(t){this.loadPOIIcons();var e=t.tags.data,i=t.groups.data,n=t.pois_in_groups.data;this.factory.createGroups(i,n),this.factory.createTags(e),this.factory.filterPOIs(this.options.filterPOIs.trim().split(","))},onDataLoaded:function(){
this.setKiosk(this.options.kiosk),this.statistics.start(),this.loadSecondaryResources(),this.cbOnProgress(100),this.cbOnDataLoaded()},createTranslations:function(t){this.translator&&t&&this.translator.setTranslations(t.data)},onProgress:function(t){"function"==typeof this.cbOnProgress&&this.cbOnProgress(t)},onStageProgress:function(t,e){"function"==typeof this.cbOnStageProgress&&this.cbOnStageProgress(t,e)},resize:function(){var t=document.getElementById(this.options.map),e=window.getComputedStyle(t,null),i=parseInt(e.width),n=parseInt(e.height);t.setAttribute("width",i+"px"),t.setAttribute("height",n+"px")},onPOIClick:function(t){"function"==typeof this.cbOnPOIClick&&this.cbOnPOIClick(t)},onZoomChange:function(t){"function"==typeof this.cbOnZoomChange&&this.cbOnZoomChange(t)},setZoom:function(){},zoomIn:function(){},zoomOut:function(){},pathToText:function(){},textPathSimplification:function(t){function e(t){return t>=45&&135>t?"right":t>=135&&225>t?"around":t>=225&&315>t?"left":!1}{var i={};i.distance=0}if(i.steps=[],t&&t.length>0){for(var n=!1,s=t[t.length-1].bNode,o=0,r=0;r<t.length;r++)i.distance+=t[r].distance,o+=t[r].distance,n=e(t[r].angle),n&&(o>0&&i.steps.push({walk:o,endNode:t[r].bNode,startNode:s}),i.steps.push({turn:n,endNode:t[r].bNode,startNode:s}),s=t[r].bNode,o=0),t[r].go_to_floor&&(o>0&&i.steps.push({walk:o,endNode:t[r].bNode,startNode:s}),o=0,t[r].type&&"generic"!==t[r].type&&i.steps.push({use:t[r].type,endNode:t[r].bNode,startNode:s}),i.steps.push({go_to_floor:t[r].go_to_floor,endNode:t[r].bNode,startNode:s}),s=t[r].bNode);o>0&&i.steps.push({walk:o,endNode:t[t.length-1].bNode,startNode:s})}return i},getPOIWithExternalId:function(t){for(var e in this.pois)if(this.pois[e].room_id==t)return this.pois[e];return!1},getNearestPOI:function(){},restoreDefaultState:function(){this.options.language&&this.setLanguage(this.options.language),this.clearHighlights(),this.showKiosk()},showScreensaver:function(){},hideScreensaver:function(){},setHighlights:function(){},clearHighlights:function(){},onSetLanguage:function(){},getLanguages:function(){return this.languages},getPOIs:function(){return this.pois},getPOIsArray:function(){return this.poisArray},getPOIGroups:function(){return this.poiGroups},getNodes:function(){return this.nodes},getEdges:function(){return this.edges},clearPath:function(){},zoomOnPathSegment:function(){}}),WayfinderFactory=Class.extend({init:function(t){this.wayfinder=t},createFloors:function(t){if(t&&this.wayfinder.building)for(var e in t)this.wayfinder.building.addFloor(this.createFloor(t[e],this.wayfinder.languages))},createNodes:function(t){if(t)for(var e=this.wayfinder.settings.getInt("kiosk.default",0),i=this.wayfinder.building.getFloors(),n=0;n<t.length;n++){var s=this.createNode(t[n]);s&&(this.wayfinder.nodes[t[n].id]=s,s.floor_id in i&&i[s.floor_id].addNode(s),t[n].id==e&&(this.wayfinder.kiosk=s))}},createAttributes:function(t){t&&(this.wayfinder.attributes=t)},createPOIs:function(t){for(var e=0;e<t.length;e++){var i=this.createPOI(t[e],this.wayfinder.languages);this.wayfinder.pois[t[e].id]=i,this.wayfinder.poisArray.push(i),i.node_id in this.wayfinder.nodes&&this.wayfinder.nodes[i.node_id].addPOI(i),this.wayfinder.poisettings&&this.wayfinder.poisettings.data&&this.wayfinder.poisettings.data[i.id]&&(i.settings.data=this.wayfinder.poisettings.data[i.id])}},createTags:function(t){if(t)for(var e in t){var i=t[e],n=this.wayfinder.pois[i.poi_id];n&&n.setTags(i.tags)}},filterPOIs:function(t){if(t&&t.length>0){var e,i="";for(var n in t)if(i=t[n].trim(),i&&""!==i)for(var s in this.wayfinder.pois)e=this.wayfinder.pois[s],e.setShowInMenu(!1),e.getTags().indexOf(i)>-1&&e.setShowInMenu(!0)}},createGroups:function(t,e){if(e&&t){var i,n;for(n in t)i=this.createPOIGroup(t[n],this.wayfinder.languages),this.wayfinder.poiGroups[i.getID()]=i;for(var s in e){n=e[s];for(var o in n){var r=this.wayfinder.pois[n[o]];i=this.wayfinder.poiGroups[s],r&&i&&(i.addPOI(r),r.addGroup(i))}}}},createAdvertisements:function(t){if(t)for(var e in t){var i=t[e],n=this.wayfinder.pois[i.poi_id];if(n){var s=this.createPOIAdvertisement(n,i,this.wayfinder.languages);this.wayfinder.poiAdvertisements[i.id]=s,n.addAdvertisement(s)}}},addPOIsToFloor:function(t){for(var e in t){var i=this.wayfinder.building.getFloors();if(e in i){var n=i[e];for(var s in t[e])t[e][s]in this.wayfinder.pois&&n.addPOI(this.wayfinder.pois[t[e][s]])}}},createEdges:function(t){this.wayfinder.edges=t},createBuilding:function(t){return new Building(t)},createFloor:function(t,e){return new Floor(t,e)},createNode:function(t){return new NavigationNode(t)},createPOI:function(t,e){return new POI(t,e)},createPOIGroup:function(t,e){return new POIGroup(t,e)},createPOIAdvertisement:function(t,e,i){return new POIAdvertisement(t,e,i)}}),ArrayUtility=Class.extend({init:function(t){if(t instanceof Object){var e=t;this.data=[];for(var i in e)this.data.push(e[i])}else{if(!(t instanceof Array))throw"Argument objectOrArray must be an object or array";this.data=t}},get:function(){return this.data},sort:function(t){var e=function(e,i){return t(e,i)?1:t(i,e)?-1:0};return this.data.sort(e),this.data}}),Color=function(t,e,i,n){this.r=1,this.g=1,this.b=1,this.a=1,this.clone=function(){return new Color(this.r,this.g,this.b,this.a)},this.fromHex=function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(t);return e&&(this.r=parseInt(e[1],16)/255,this.g=parseInt(e[2],16)/255,this.b=parseInt(e[3],16)/255,e[4]&&(this.a=parseInt(e[4],16)/255)),this},this.toHex=function(){var t=function(t){var e=t.toString(16);return 1==e.length?"0"+e:e};return"#"+t(255*this.r)+t(255*this.g)+t(255*this.b)+t(255*this.a)},this.toString=function(){return"rgba("+Math.floor(255*this.r)+", "+Math.floor(255*this.g)+", "+Math.floor(255*this.b)+", "+this.a+")"},this.toVector=function(){return vec4.fromValues(this.r,this.g,this.b,this.a)},this.set=function(t,e,i,n){"number"==typeof t&&(this.r=t),"number"==typeof e&&(this.g=e),"number"==typeof i&&(this.b=i),"number"==typeof n&&(this.a=n)},this.set(t,e,i,n)},Building=Class.extend({init:function(t){this.name=t["building.name"],this.address=t["building.address"],this.link=new Translations(t["building.link"]),this.description=new Translations(t["building.description"]),this.logoID=t["building.logo"],this.backgroundID=t["building.background"],this.floors={}},addFloor:function(t){this.floors[t.id]=t},removeFloor:function(t){delete this.floors[t.id]},getFloors:function(){return this.floors},getSortedFloors:function(){var t=new ArrayUtility(this.floors);return t.sort(function(t,e){return t.index<e.index})}}),Settings=Class.extend({init:function(){this.data={}},has:function(t){return t in this.data},get:function(t,e,i){return i&&i.settings.data&&i.settings.data[t]?i.settings.data[t].value:t in this.data?this.data[t]:e},getInt:function(t,e){return parseInt(this.get(t,e))},getFloat:function(t,e,i){return parseFloat(this.get(t,e,i))},getColor:function(t,e,i){return(new Color).fromHex(this.get(t,e,i))},getBoolean:function(t,e,i){return this.get(t,e,i)===!0},getModel:function(t,e,i){var n=this.getInt(t,0,i);return 0===n?e:n},set:function(t,e){this.data[t]=e},override:function(t){for(var e in t)this.data[e]=t[e]}}),NavigationNode=Class.extend({init:function(t){this.id=t.id,this.floor_id=t.level_id,this.type=t.type,this.position=vec3.fromValues(-parseFloat(t.x),parseFloat(t.y),parseFloat(t.z)),this.rotation=vec3.fromValues(parseFloat(t.rotation_x),parseFloat(t.rotation_y),parseFloat(t.rotation_z)),this.floor=!1,this.pois=[],this.weight=0,t.weight&&(this.weight=parseFloat(t.weight)),this.zoom=0,t.zoom&&(this.zoom=parseFloat(t.zoom))},setFloor:function(t){t instanceof Floor&&t.id==this.floor_id&&(this.floor=t)},addPOI:function(t){t instanceof POI&&t.node_id==this.id&&(t.setNode(this),this.pois.push(t))},getID:function(){return this.id},getFloor:function(){return this.floor},getPOIs:function(){return this.pois}}),Floor=Class.extend({init:function(t,e){this.id=parseInt(t.id,10),this.name_id=parseInt(t.name_id,10),this.model_id=parseInt(t.model_id,10),this.index=parseInt(t.index,10),this.y=parseFloat(t.y,10),this.lightmap_id=parseInt(t.lightmap_id,10),this.showInMenu=0!==parseInt(t.show_in_menu,10),this.names=new Translations;for(var i in e)this.names.set(i,t[i]);this.pois=[],this.nodes=[]},getID:function(){return this.id},getName:function(t){return this.names.get(t)},getNames:function(){return this.names},addPOI:function(t){t instanceof POI&&(t.setFloor(this),this.pois.push(t))},addNode:function(t){t instanceof NavigationNode&&t.floor_id==this.id&&(t.setFloor(this),this.nodes.push(t))},getPOIs:function(){return this.pois},getNodes:function(){return this.nodes},getShowInMenu:function(){return this.showInMenu}}),POI=Class.extend({init:function(t,e){this.id=parseInt(t.id),this.type=t.type,this.node_id=parseInt(t.node_id),this.mesh_id=parseInt(t.mesh_id),this.room_id=t.room_id,this.image_id=parseInt(t.image_id),this.icon=null,this.background_id=parseInt(t.background_id),this.background=null,this.showInMenu=0!=parseInt(t.show_in_menu),this.alwaysVisible=0!=parseInt(t.always_visible),this.settings={},this.names=new Translations,this.descriptions=new Translations,this.hasName=!1;for(var i in e)this.names.set(i,t["names_"+i]),this.descriptions.set(i,t["descriptions_"+i]),this.names.get(i).length>0&&(this.hasName=!0);this.floor=!1,this.node=!1,this.groups=[],this.advertisements=[],this.groupNames={},this.tags=""},getID:function(){return this.id},getName:function(t){return this.names.get(t)},getNames:function(){return this.names},getDescription:function(t){return this.descriptions.get(t)},getShowInMenu:function(){return this.showInMenu&&this.hasName},setShowInMenu:function(t){this.showInMenu=t},setFloor:function(t){t instanceof Floor&&(this.floor=t)},getFloor:function(){return this.floor},setNode:function(t){t instanceof NavigationNode&&(this.node=t)},getNode:function(){return this.node},addGroup:function(t){this.groups.push(t)},getGroups:function(){return this.groups},getGroupNames:function(){if(this.groupNames[n])return this.groupNames[n];var t={};for(var e in this.groups){var i=this.groups[e].getNames();for(var n in i.getAll())t[n]||(t[n]=[]),t[n].push(i.get(n))}return this.groupNames[n]=t,t},addAdvertisement:function(t){this.advertisements.push(t)},getAdvertisements:function(){return this.advertisements},getTags:function(){return this.tags},setTags:function(t){this.tags=t},setIcon:function(t){this.icon=t},getIcon:function(){return this.icon},setBackground:function(t){this.background=t},getBackground:function(){return this.background},getRoomId:function(){return this.room_id},isAlwaysVisible:function(){return this.alwaysVisible}}),POIAdvertisement=Class.extend({init:function(t,e,i){this.id=e.id,this.image_id=e.image_id,this.text1={},this.text2={},this.link={},this.poi=t;for(var n in i)this.link[n]=e["link_"+n],this.text1[n]=e["text1_"+n]?e["text1_"+n]:e["menu_"+n],this.text2[n]=e["text2_"+n]?e["text2_"+n]:e["3d_"+n]},getID:function(){return this.id},getPOI:function(){return this.poi},getText1:function(t){return t in this.text1?this.text1[t]:!1},getText2:function(t){return t in this.text2?this.text2[t]:!1},getLink:function(t){return t in this.link?this.link[t]:!1}}),POIGroup=Class.extend({init:function(t,e){this.id=t.group_id,this.names=new Translations,this.imageID=t.image_id;for(var i in e)this.names.set(i,t[i]);this.pois=[],this.showInMenu=t.show_main,this.showInTopMenu=t.show_top,this.color=(new Color).fromHex(t.color)},getID:function(){return this.id},getNames:function(){return this.names},getName:function(t){return this.names.get(t)},getNames:function(){return this.names},getShowInMenu:function(){return 0!=this.showInMenu},getShowInTopMenu:function(){return 0!=this.showInTopMenu},getImageID:function(){return this.imageID},addPOI:function(t){this.pois.push(t)},getPOIs:function(){return this.pois},getColor:function(){return this.color}}),Logistics=function(){var t=!1;"undefined"!=typeof window&&(t="localStorage"in window&&null!==window.localStorage);var e=[],i=[],n={},s=0,o=!1,r=null,a=null,h=null,u=null,c={loadFromLocalStorage:!1,storeToLocalStorage:!1,loadFromFile:!1,enableCORS:!0,useCookies:!1,fallbackFromStorage:!0},d={text:{load:function(t){x(t)},parse:function(t,e){t.data=e.responseText},store:function(t){return t.data},restore:function(t,e){return e}},json:{load:function(t){x(t)},parse:function(t,e){try{t.data=JSON.parse(e.responseText)}catch(i){"undefined"!=typeof console&&console.error&&console.error("JSON parsing failed for "+t.url,i)}},store:function(t){return JSON.stringify(t.data)},restore:function(t,e){return e?JSON.parse(e):{}}},xml:{load:function(t){x(t)},parse:function(t,e){t.data=e.responseXML?e.responseXML:W(e.responseText)},store:function(t){return XMLSerializer?(new XMLSerializer).serializeToString(t.data):""},restore:function(t,e){return W(e)}},image:{load:function(t){t&&(t.data=new Image,t.useCORS&&(t.data.crossOrigin="Anonymous"),t.data.onload=function(){t.ready()},t.data.onerror=function(){t.failed()},t.data.src=t.url)},parse:function(){},store:function(t){var e=document.createElement("canvas");e.width=t.data.width,e.height=t.data.height;var i=e.getContext("2d");i.drawImage(t.data,0,0);var n=e.toDataURL("image/png");return e=null,n},restore:function(t,e){var i=new Image;return i.src=e,i}},binary:{load:function(t){x(t)},parse:function(t,e){t.data=e.response},store:function(t){for(var e="",i=new Uint8Array(t.data),n=i.byteLength,s=0;n>s;s++)e+=String.fromCharCode(i[s]);return window.btoa(e)},restore:function(t,e){for(var i=new ArrayBuffer(2*e.length),n=new Uint16Array(i),s=0,o=e.length;o>s;s++)n[s]=e.charCodeAt(s);return i}}},l=function(t,e,i,n,o,r){this.url=t,this.params=e,this.success=i,this.dataType=n,this.loaded=!1,this.data=!1,this.requestType=o,this.useCORS=!1,this.options=r?r:{},this.successCallback=i,this.errorCallback=!1,this.alwaysCallback=!1,this.progressCallback=!1,this.setOption=function(t,e){this.options[t]=e},this.getOption=function(t){return this.options[t]},this.ready=function(){this.loaded=!0,s++,T(this),N(this)},this.failed=function(){s++,N(this),D(this)},this.done=function(t){this.successCallback=t},this.fail=function(t){this.errorCallback=t},this.error=function(t){this.errorCallback=t},this.always=function(t){this.alwaysCallback=t},this.progress=function(t){this.progressCallback=t},this.toString=function(){return this.data}},f=function(t,e,i){this.urls=t,this.results={},this.loadedCount=0,this.count=0,this.successCallback=e,i=i?i:{},this.load=function(){var t=null,e=null;for(var n in this.urls)this.urls.hasOwnProperty(n)&&this.count++;for(var s in this.urls)if(e=this.urls[s],e&&e.url&&e.type)try{t=g(e.url,void 0,z(this,this.ready,s),e.type,JSON.parse(JSON.stringify(i))),t.setOption("logistics.multi.key",s),t.fail(z(this,this.fail))}catch(o){this.fail()}},this.ready=function(t,e,i){var n=i.getOption("logistics.multi.key");this.results[n]=t,this.loadedCount++,this.checkIfAllReady()},this.fail=function(){this.loadedCount++,this.checkIfAllReady()},this.getKeyForURL=function(){},this.checkIfAllReady=function(){this.loadedCount>=this.count&&"function"==typeof this.successCallback&&this.successCallback(this.results)}},g=function(t,i,n,s,o){var r="GET";"function"==typeof i?(n=i,i=void 0):i&&"object"==typeof i&&(r="POST");var a=new l(t,i,n,s,r,o);return c.enableCORS&&(a.useCORS=m(t)),a&&(e.push(a),v(a)),a},p=function(t,e,n){var s=new f(t,e,n);i.push(s),s.load()},m=function(t){if("undefined"==typeof document)return!1;var e=t.match(/(https?:)?\/\/([^\/]+)\/(.*)/);return e?document&&e[1]===document.location.origin?!1:!0:!1},y=function(t){if(t){var e=t.getOption("stage");e&&("object"!=typeof n[e]&&(n[e]=[]),n[e].push(t))}},v=function(t){return I(t),!0},I=function(t){y(t),c.loadFromLocalStorage&&P(t)?A(t):w(t.dataType,"load")(t)},P=function(e){return t&&null!==localStorage.getItem(e.url)?!0:!1},A=function(t){t.data=w(t.dataType,"restore")(t,R(t)),t.ready()},w=function(t,e){return d&&d[t]&&d[t][e]?d[t][e]:d&&d[t]?d[t]:function(){"undefined"!=typeof console&&console.warn&&console.warn("Method "+e+" for "+t+" not found")}},b=function(t,e){t&&e&&(d[t]=e)},x=function(t){var e=L(t);if(!e||!t)throw"http failed";var i=t.url;e.open(t.requestType,i,!0),e.overrideMimeType&&e.overrideMimeType("text/xml"),"binary"==t.dataType&&(e.responseType="arraybuffer",t.useCORS&&e.setRequestHeader("Content-Type","application/x-3dtechdata")),"default"==t.dataType&&(e.responseType="arraybuffer",t.useCORS&&e.setRequestHeader("Content-Type","application/octet-stream")),t.useCORS&&c.useCookies&&(e.withCredentials=!0),e.onreadystatechange=function(){4==e.readyState?200==e.status?(w(t.dataType,"parse")(t,e),t.ready()):t.failed():"function"==typeof t.progressCallback&&t.progressCallback(e)},e.ontimeout=function(){t.failed()},e.onerror=function(){t.failed()},N(t),e.send(null)},W=function(t){var e=null;if(!t||"string"!=typeof t)return e;if(window&&window.DOMParser){var i=new DOMParser;e=i.parseFromString(t,"text/xml")}else e=new ActiveXObject("Microsoft.XMLDOM"),e.async=!1,e.loadXML(t);if(!e||e.getElementsByTagName("parsererror").length)throw"XML parsing failed";return e},L=function(t){var e=!1;if(t.useCORS&&window&&window.XDomainRequest)try{e=new XDomainRequest}catch(i){e=!1}else if(XMLHttpRequest)try{e=new XMLHttpRequest}catch(n){e=!1}else if("undefined"!=typeof ActiveXObject)try{e=new ActiveXObject("Msxml2.XMLHTTP"),alert(2)}catch(n){try{e=new ActiveXObject("Microsoft.XMLHTTP"),alert(3)}catch(i){e=!1}}return e},O=function(){e=[],i=[],s=0,o=!1},M=function(){if(t)for(var i in e)C(e[i]);else console.warn("localStorage isn't supported")},S=function(){localStorage.clear()},C=function(e){if(t)try{localStorage[e.url]=w(e.dataType,"store")(e)}catch(i){console.warn("localStorage limit exceeded")}else console.warn("localStorage isn't supported")},R=function(t){return localStorage[t.url]},T=function(t){t&&"function"==typeof t.successCallback&&(t.successCallback(t.data,"success",t),U()),t&&c.storeToLocalStorage&&C(t)},D=function(t){if(t&&c.fallbackFromStorage&&P(t))return void A(t);if(!t||"function"!=typeof t.errorCallback)throw"Resource "+t.url+" not loaded";t.errorCallback(t,"error",""),U()},N=function(t){a&&"function"==typeof a&&e.length&&s&&a(s/e.length),t&&t.getOption("stage")&&k(t)},k=function(t){if(h&&"function"==typeof h){for(var e=n[t.getOption("stage")],i=e.length,s=0,o=0;i>o;o++)e[o]&&e[o].loaded&&s++;i>0&&h(t.getOption("stage"),s/i)}},U=function(){null===u&&(u=setTimeout(F,5))},F=function(){u=null,e.length==s&&r&&"function"==typeof r&&r()},z=function(t,e){return function(){return e.apply(t,arguments)}},E=function(t,e){c[t]=e},V=function(t){return c[t]};return{count:function(){return e.length},loadedCount:function(){return s},clear:function(){O()},get:function(t,e,i,n,s){return g(t,e,i,toLowerCase(n),s)},getJSON:function(t,e,i,n){return g(t,e,i,"json",n)},getImage:function(t,e,i,n){return g(t,e,i,"image",n)},getBinary:function(t,e,i,n){return g(t,e,i,"binary",n)},getXML:function(t,e,i,n){return g(t,e,i,"xml",n)},getText:function(t,e,i,n){return g(t,e,i,"text",n)},getMultiple:function(t,e,i){p(t,e,i)},store:function(){M()},clearStorage:function(){S()},types:function(){return d},onFinishedLoading:function(t){r=t},onProgress:function(t){a=t},onStageProgress:function(t){h=t},getQueue:function(){return e},getTypeFunction:function(t,e){return w(t,e)},setTypeFunction:function(t,e){return b(t,e)},getOption:function(t){return V(t)},setOption:function(t,e){E(t,e)},start:function(){return start()}}}(),Language=Class.extend({init:function(t){this.name=t.name,this.id=t.id,this.nativeName=t["native"],this.textDirection=t.text_direction,this.flagImage=t.flag},getName:function(){return this.name},getID:function(){return this.id},getNativeName:function(){return this.nativeName},getTextDirection:function(){return this.text_direction}}),Translator=Class.extend({init:function(t,e){this.language=t,this.translations=e},setTranslations:function(t){this.translations=t},setLanguage:function(t){this.language=t},getLanguage:function(){return this.language},get:function(t,e){if(this.translations&&t&&this.translations[t]&&this.translations[t][this.language]){var i=this.translations[t][this.language];return e&&(i=this.replaceValues(i,e)),i}return t},translate:function(t){var e=this;t&&(this.language=t),"undefined"!=typeof $&&($("[data-translation-element]").each(function(){e.translateElement($(this),$(this).attr("data-translation-element"))}),$("[data-translation-attributes]").each(function(){var t=$(this).attr("data-translation-attributes").split(","),i="";for(var n in t)i=$(this).attr("data-translation-attribute-"+t[n]),i&&$(this).attr(t[n],e.get(i))}))},setElement:function(t,e){t&&e&&t.attr("data-translation-element",e)},setAttribute:function(t,e,i){if(t&&i&&e){var n=[];t.attr("data-translation-attributes")&&(n=t.attr("data-translation-attributes").split(",")),n.push(e),t.attr("data-translation-attributes",n.join(",")),t.attr("data-translation-attribute-"+e,i)}},translateElement:function(t,e,i){if(t)if(e&&this.exists(e)){var n=this.get(e,i);this.setElement(t,e),t.html(n)}else t.addClass("no-translation")},translateAttribute:function(t,e,i,n){if(t&&e&&i){var s=this.get(i,n);this.setAttribute(t,e,i),t.attr(e,s),this.exists(i)||t.addClass("no-translation")}},replaceValues:function(t,e){if(t&&e){var i=0;for(var n in e)t=t.replace("%"+i++,e[n])}return t},exists:function(t){return this.translations&&t&&this.translations[t]&&this.translations[t][this.language]?!0:!1}}),Translations=Class.extend({init:function(t){this.translations=t?t:{}},set:function(t,e){this.translations[t]=e},get:function(t){return this.translations[t]?this.translations[t]:!1},setAll:function(t){this.translations=t},getAll:function(){return this.translations},setTranslations:function(t,e){if(t&&e){for(var i in this.translations)t.attr("data-lang-"+i,this.translations[i]);t.html(this.translations[e]?this.translations[e]:"no translation"),t.attr("data-translated",!0)}}}),TranslationsMap=Class.extend({init:function(){this.translations={}},add:function(t,e){if(!(e instanceof Translations))throw"Only Translation instances can be added to translations map";this.translations[t]=e},get:function(t){return this.translations[t]?this.translations[t]:new Translations({english:"--missing--"})}}),WFStatistics=Class.extend({init:function(t){this.wayfinder=t,this.session_id=0,this.storageSupport="undefined"!=typeof window&&"localStorage"in window&&null!==window.localStorage,this.storagePrefix="wfstats_",this.device_id=0,this.searchPhrase="",this.checkStorage()},start:function(){var t=this;"undefined"!=typeof screen&&WayfinderAPI.statistics.device(screen.width,screen.height,this.wayfinder.getKiosk(),function(e){e&&(t.device_id=e.data.id,t.store("deviceId",e.data.id),log("Device created",e))})},onSessionStart:function(){var t=this,e=this.wayfinder.languages[this.wayfinder.getLanguage()];e&&e.getID()&&this.wayfinder.getKiosk()&&WayfinderAPI.statistics.startSession(e.getID(),this.wayfinder.getKiosk(),this.wayfinder.options.application,this.wayfinder.getLayout(),this.device_id,function(e){try{e&&(t.session_id=e.data)}catch(i){log("Something went wrong sending startSession")}})},onSessionEnd:function(){var t=this;if(this.session_id){var e=this.wayfinder.languages[this.wayfinder.getLanguage()];WayfinderAPI.statistics.endSession(this.session_id,e.getID(),function(){t.session_id=0,log("Session ended!")})}},onClick:function(t,e){WayfinderAPI.statistics.click(t,this.session_id,e)},onLanguageChange:function(){},onSearch:function(t,e){WayfinderAPI.statistics.search(t,this.session_id,e)},checkStorage:function(){this.storageSupport&&(this.deviceId=localStorage.getItem(this.storagePrefix+"deviceId"))},getTime:function(){},store:function(t,e){this.storageSupport&&(localStorage[this.storagePrefix+t]=JSON.stringify(e))},isOnline:function(){}}),WayfinderFactory2D=WayfinderFactory.extend({createOverlays:function(t){if(t){var e,i;for(e in t)if(e in this.wayfinder.pois){e in this.wayfinder.overlays||(this.wayfinder.overlays[e]=[]);for(i in t[e])this.wayfinder.overlays[e].push(new Overlay(this.wayfinder.pois[e],t[e][i]))}}},addNode2DData:function(t){if(this.wayfinder.nodes)for(var e in this.wayfinder.nodes){var i=this.wayfinder.nodes[e];if(t[i.floor_id]){var n=t[i.floor_id][i.id];n&&(i.setPosition2D(n.x,n.y),i.setWeight(n.weight))}}},createEdges:function(t){if(t)for(var e in t)if(e in this.wayfinder.nodes)for(var i in t[e])t[e][i]in this.wayfinder.nodes&&this.wayfinder.nodes[e].addNeighbour(this.wayfinder.nodes[t[e][i]])},createNode:function(t){return new NavigationNode2D(t)}}),Wayfinder2D=Wayfinder.extend({init:function(t){t&&t instanceof Wayfinder2DOptions||(t=new Wayfinder2DOptions),this._super(t,new WayfinderFactory2D(this)),this.setup(),this.map.onPOIClick=ClassCallback(this,this.onPOIClick),this.map.getTransformer().cbOnZoomChange=ClassCallback(this,this.onZoomChange),this.overlays={},this.adImage=!1,this.yahImage=!1},setup:function(){window.G_vmlCanvasManager&&window.G_vmlCanvasManager.initElement(document.getElementById(this.options.map)),this.canvas=document.getElementById(this.options.map),this.map=new Map2D(this)},isCanvasSupported:function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))},showPath:function(t,e){if(this.getKiosk()!==!1&&t!==!1){var i=new PathFinder2D(this.nodes),n=i.find(this.getKiosk(),t.id);if(n!==!1){var s=this;return this.map.fitPathInView(n),this.map.pathRenderer.reset(),this.map.setCurrentFloor(this.getKioskNode().floor),this.map.redraw(),this.map.pathRenderer.setPath(n,function(){e&&(s.clearHighlights(),s.setHighlights([e])),s.map.redraw()}),n}}},showFloor:function(t){this._super(t),this.map.setCurrentFloor(t)},onDataLoaded:function(){this._super(),this.map.addRenderers(),this.cbOnDataLoaded&&"function"==typeof this.cbOnDataLoaded&&this.cbOnDataLoaded(),this.padding=this.settings.getInt("path.2d.padding",this.options.pathZoomPadding),this.resize(),this.setupFloor(),this.map.currentFloorID&&this.map.fitMultiplePOIsInView(this.building.getFloors()[this.map.currentFloorID].pois),this.map.start()},onPOIsLoaded:function(t){this._super(t),Logistics.getMultiple({nodes_2d:{url:WayfinderAPI.getURL("2d","nodes",[]),type:"json"},overlays:{url:WayfinderAPI.getURL("2d","overlays",[]),type:"json"},location:{url:WayfinderAPI.getURL("building","location",[]),type:"json"},lodcount:{url:WayfinderAPI.getURL("2d","lodcount",[]),type:"json"},"ad-image":{url:"images/ad.png",type:"image"},"yah-image":{url:"images/yah.png",type:"image"}},ClassCallback(this,this.on2DDataLoaded),{stage:"settings"}),this.loadMapImages()},on2DDataLoaded:function(t){var e=t.nodes_2d.data,i=t.overlays.data;this.adImage=t["ad-image"],this.yahImage=t["yah-image"],this.options.maxLOD=t.lodcount.data,this.factory.addNode2DData(e),this.factory.createOverlays(i),this.onDataLoaded()},setupFloor:function(){var t=!1;if(this.getKioskNode()&&this.getKioskNode().floor)t=this.getKioskNode().floor;else{var e=0;for(var i in this.building.getFloors())t=this.building.getFloors()[i],t.index>=e&&(e=t.index)}t&&(this.map.currentFloorID=t,this.showFloor(t))},loadMapImages:function(){var t,e=this,i=function(t,i,n){e.map.addLODImage(n.params.floor_id,0,0,0,t)};for(var n in this.building.getFloors())t=this.building.getFloors()[n],Logistics.getImage(WayfinderAPI.getURL("2d","image",[t.id]),{floor_id:t.id},i,{stage:"floors"})},resize:function(){this._super(),this.map&&this.map.resize(this.canvas.width,this.canvas.height),this.map.redraw()},setZoom:function(t){this.map.setZoom(t),this.map.update(!0)},zoomIn:function(){this.map.zoomIn(),this.map.update(!0)},zoomOut:function(){this.map.zoomOut(),this.map.update(!0)},setHighlights:function(t){this.map.setHighlights(t),this.map.update(!0)},clearHighlights:function(){this.map.clearHighlights(),this.map.update(!0)},showKiosk:function(){this.getKiosk()!==!1&&(this.map.pathRenderer.reset(),this.map.setCurrentFloor(this.getKioskNode().floor),this.map.currentFloorID&&this.map.fitMultiplePOIsInView(this.building.getFloors()[this.map.currentFloorID].pois),"function"==typeof this.cbOnFloorChange&&this.cbOnFloorChange(this.getKioskNode().floor),this.map.redraw())},clearPath:function(){this.map.pathRenderer.reset(),this.map.update(!0)}}),Wayfinder2DOptions=WayfinderOptions.extend({init:function(){this._super(),this.pathDisplayInstructions=!0,this.pathZoomPadding=50,this.pathColor="rgba(255,0,0,0.8)",this.pathPauseTime=2e3,this.pathSpotRadius=3,this.pathStride=10,this.pathSpeed=60,this.poiColor="rgba(100,100,100,0.5)",this.poiRadius=5,this.mapSize=[1024,1024],this.forceFullMapUpdate=!1,this.enableLOD=!0,this.maxLOD=2,this.enableUserLocation=!0,this.overlayHighlightColor="#ff0000dd",this.mapPadding=.1,this.enableUserYAHSetting=!1,this.application="2D",this.pathZoomIn=!1,this.poi2DTitlePadding=12,this.path2DMessageSize=16,this.map2DRotation=0,this.debugMouseLocation=!1}}),ArrayUtility=Class.extend({init:function(t){if(t instanceof Object){var e=t;this.data=[];for(var i in e)this.data.push(e[i])}else{if(!(t instanceof Array))throw"Argument objectOrArray must be an object or array";this.data=t}},get:function(){return this.data},sort:function(t){var e=function(e,i){return t(e,i)?1:t(i,e)?-1:0};return this.data.sort(e),this.data}}),NavigationNode2D=NavigationNode.extend({init:function(t){this._super(t),this.position2d=!1,this.weight=!1,this.neighbours=[]},setPosition2D:function(t,e){this.position2d=vec2.fromValues(parseFloat(t),parseFloat(e))},setWeight:function(t){this.weight=parseFloat(t)},addNeighbour:function(t){t instanceof NavigationNode2D&&this.neighbours.push(t)}}),Overlay=Class.extend({init:function(t,e){this.visible="1"==e.visible?!0:!1,this.polygon=this.createPolygon(e.polygon),this.poi=t,this.bounds=this.calculateBounds(this.polygon,0),this.rotatedAreaBounds=this.calculateRotatedAreaBounds()},createPolygon:function(t){for(var e=[],i=0;i<t.length;i++)t[i]&&t[i].x&&t[i].y&&e.push(vec2.fromValues(t[i].x,t[i].y));return e},contains:function(t){var e,i,n=!1;for(e=0,i=this.polygon.length-1;e<this.polygon.length;i=e++)this.polygon[e][1]>t[1]!=this.polygon[i][1]>t[1]&&t[0]<(this.polygon[i][0]-this.polygon[e][0])*(t[1]-this.polygon[e][1])/(this.polygon[i][1]-this.polygon[e][1])+this.polygon[e][0]&&(n=!n);return n},calculateBounds:function(t,e){for(var i,n=1/0,s=1/0,o=-(1/0),r=-(1/0),a=0;a<t.length;a++)i=t[a],e&&(i=this.rotatePoint(i,e)),n=Math.min(n,i[0]),s=Math.min(s,i[1]),o=Math.max(o,i[0]),r=Math.max(r,i[1]);return i=this.rotatePoint(vec2.fromValues(n,s),-e),[i[0],i[1],o-n,r-s,o,r]},calculateRotatedAreaBounds:function(){var t,e,i,n,s=1/0,o=0,r=0,a=0,h=1,u=0,c=vec2.create(),d=vec2.create();this.hull=this.findConvexHull();for(var l=0;l<this.hull.length-1;l++)r=this.calculateEdgeAngleFromAxis(this.hull[l],this.hull[l+1]),a=-1===r[1]?r[0]:Math.PI-r[0],e=this.calculateBounds(this.hull,a),Math.abs(e[2]*e[3])<s?(s=Math.abs(e[2]*e[3]),i=this.hull[l],n=this.hull[l+1],t=e,h=r[1],o=h*r[0]):Math.abs(e[2]*e[3])==s&&(vec2.sub(d,i,n),vec2.sub(c,this.hull[l],this.hull[l+1]),u=vec2.len(d),vec2.len(c)>vec2.len(d)&&(s=Math.abs(e[2]*e[3]),i=this.hull[l],n=this.hull[l+1],t=e,h=r[1],o=h*r[0]));var f=vec2.fromValues(t[0],t[1]),g=vec2.fromValues(t[2]/2,t[3]/2);return g=this.rotatePoint(g,o),-1==h?vec2.add(g,f,g):vec2.sub(g,f,g),{edge:[i,n,vec2.sub(vec2.create(),i,n),this.getOrientation(i,n,g)],angle:o,bounds:{corner:f,width:t[2],height:t[3]},center:g,direction:h}},findConvexHull:function(){var t,e=[],i=0;if(this.polygon.length>0){for(var n=this.polygon[0],s=1;s<this.polygon.length;s++)this.polygon[s][0]<n[0]&&(n=this.polygon[s]);var o=this.polygon;do{i++,e.push(n),t=o[0];for(var r=1;r<o.length;r++)(n==t||-1==this.getOrientation(n,t,o[r]))&&(t=o[r]);if(i>1e3){console.log("Hull finding is ending to infinity loop!",this.polygon[0],this.polygon[this.polygon.length-1],t,e[0]);break}n=t}while(e[0]!==t)}return e},getOrientation:function(t,e,i){var n=(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1]);return n>0?-1:0>n?1:0},calculatePointDistanceFromEdge:function(t,e,i){
var n=Math.abs((e.x-t.x)*(t.y-i.y)-(t.x-i.x)*(e.y-t.y)),s=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));return n/s},calculateEdgeAngleFromAxis:function(t,e){var i=vec2.fromValues(e[0]-t[0],e[1]-t[1]),n=vec2.fromValues(1,0),s=vec2.fromValues(-1,0),o=vec2.dot(i,s),r=vec2.len(i)*vec2.len(s),a=vec2.dot(i,n),h=vec2.len(i)*vec2.len(n),u=Math.acos(a/h),c=Math.acos(o/r);return u>c?[c,-1]:[u,1]},getBounds:function(){return this.bounds},getRotatedAreaBounds:function(){return this.rotatedAreaBounds},rotatePoint:function(t,e){var i=t[0]*Math.cos(e)-t[1]*Math.sin(e),n=t[1]*Math.cos(e)+t[0]*Math.sin(e);return vec2.fromValues(i,n)}}),Renderer2D=Class.extend({init:function(t){this.wayfinder=!1,this.context=!1,this.enabled=!0,this.damaged=!0,this.renderQueue=t},onAdd:function(){},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},damage:function(){this.damaged=!0},undamage:function(){this.damaged=!1},setContext:function(t){this.context=t},setWayfinder:function(t){this.wayfinder=t},render:function(){}}),FloorRenderer2D=Renderer2D.extend({init:function(){this._super(1),this.lod=0,this.debugPoint=vec2.create(),this.mapImages=[]},setLOD:function(t){this.lod=t},getLOD:function(){return lod},getRequiredTiles:function(t){for(var e=[],i=Math.pow(2,this.lod),n=this.wayfinder.options.mapSize[0]/i,s=this.wayfinder.options.mapSize[1]/i,o=0;i>o;o++)for(var r=0;i>r;r++){var a=new Rectangle(o*n,r*s,n,s);t.intersects(a)&&e.push(vec2.fromValues(o,r))}return e},clear:function(){this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height)},renderDefault:function(){var t=this.wayfinder.map.getTransformer(),e=this.wayfinder.map.getCurrentLOD(0,0,0);e&&(this.context.save(),this.clear(),this.context.translate(t.getViewWidth()/2,t.getViewHeight()/2),this.context.rotate(this.wayfinder.options.map2DRotation*Math.PI/180),this.context.translate(-t.getViewWidth()/2,-t.getViewHeight()/2),this.context.translate(t.getZoomedMapPosition()[0],t.getZoomedMapPosition()[1]),this.context.scale(t.getZoom(),t.getZoom()),this.context.drawImage(e,0,0),this.context.restore())},renderTile:function(t){if(t.image!==!1){var e=this.wayfinder.map.getTransformer(),i=Math.pow(2,this.lod),n=this.wayfinder.options.mapSize[0]/i,s=this.wayfinder.options.mapSize[1]/i;this.context.save(),this.context.translate(e.getViewWidth()/2,e.getViewHeight()/2),this.context.rotate(this.wayfinder.options.map2DRotation*Math.PI/180),this.context.translate(-e.getViewWidth()/2,-e.getViewHeight()/2),this.context.translate(e.getZoomedMapPosition()[0],e.getZoomedMapPosition()[1]),this.context.drawImage(t.image,t.x*n*e.getZoom(),t.y*s*e.getZoom(),n*e.getZoom(),s*e.getZoom()),this.context.restore()}},render:function(t){if(0!==this.wayfinder.map.currentFloorID){var e,i=this.wayfinder.map.getTransformer();if(0!==this.lod&&this.wayfinder.options.enableLOD){var n=[],s=this.getRequiredTiles(t),o=!1;for(e=0;e<s.length;e++){var r=this.wayfinder.map.getCurrentLOD(this.lod,s[e][0],s[e][1]);n.push({x:s[e][0],y:s[e][1],image:r}),r===!1&&(o=!0)}for(o&&this.renderDefault(),this.clear(),e=0;e<s.length;e++)this.renderTile(n[e])}else this.renderDefault();if(this.wayfinder.options.debugMouseLocation){this.context.save();var a=i.transformPoint(this.debugPoint);this.context.beginPath(),this.context.fillStyle="rgba(255,0,0,0.7)",this.context.arc(a[0],a[1],5,0,2*Math.PI,!0),this.context.closePath(),this.context.fill(),this.context.restore()}}}}),POIsRenderer2D=Renderer2D.extend({init:function(){this._super(4)},onAdd:function(){this.overlayColor=this.wayfinder.settings.getColor("poi.2d.overlay.color",this.wayfinder.options.overlayHighlightColor),this.drawAlwaysNames=this.wayfinder.settings.getBoolean("poi.2d.display-names-always",!1),this.overlayColorFromGroup=this.wayfinder.settings.getBoolean("poi.2d.overlay-group-color",!1),this.fitToOverlay=this.wayfinder.settings.getBoolean("poi.2d.fit-to-overlay",!1),this.nameColor=this.wayfinder.settings.getColor("poi.2d.name.color","#000000"),this.nameBackgroundColor=this.wayfinder.settings.getColor("poi.2d.name.background-color","#ffffff"),this.nameFontSize=this.wayfinder.settings.getInt("poi.2d.name.font-size",12),this.nameFontFamily=this.wayfinder.settings.get("poi.2d.name.font-family","Arial"),this.displayRoomID=this.wayfinder.settings.get("poi.2d.name.display-room-id",!0),this.iconSize=this.wayfinder.settings.getInt("poi.2d.icon-size",this.wayfinder.options.poiRadius),this.fontPadding=this.wayfinder.settings.getInt("poi.2d.name.padding",this.wayfinder.options.poi2DTitlePadding)},render:function(){var t=this.wayfinder.map.getCurrentFloor();if(t){var e=this.wayfinder.map.getTransformer();this.context.save();for(var i in t.nodes)if(0!==t.nodes[i].pois.length){var n=!1,s=!1,o=e.transformPoint(t.nodes[i].position2d),r=!1;if(o[0]>=0&&o[0]<=e.getViewWidth()&&o[1]>=0&&o[1]<=e.getViewHeight()){for(var a in t.nodes[i].pois){if(r=t.nodes[i].pois[a],r.id in this.wayfinder.overlays){var h=this.wayfinder.overlays[r.id];if(h&&0<h.length){n=!0;for(var u in h)this.renderPOIOverlay(h[u])}}if(r.getAdvertisements().length>0){s=!0;break}r.alwaysVisible||this.isPOIinHighlights(r)?0!==r.image_id?(this.renderPOIIcon(r,o),n=!0):r.hasName&&(this.renderPOIName(r,o),n=!0):this.drawAlwaysNames&&r.showInMenu&&(this.renderPOIName(r,o),n=!0)}n||r.showInMenu||(this.context.beginPath(),this.context.fillStyle=this.wayfinder.options.poiColor,this.context.arc(o[0],o[1],this.wayfinder.options.poiRadius,0,2*Math.PI,!0),this.context.closePath(),this.context.fill()),this.wayfinder.adImage&&s&&this.context.drawImage(this.wayfinder.adImage,o[0]-1.5*this.wayfinder.options.poiRadius,o[1]-1.5*this.wayfinder.options.poiRadius,3*this.wayfinder.options.poiRadius,3*this.wayfinder.options.poiRadius)}}this.context.restore()}},isPOIinHighlights:function(t){for(var e in this.wayfinder.map.highlights)if(this.wayfinder.map.highlights[e]==t)return!0;return!1},renderPOIOverlay:function(t){if((t.visible||this.isPOIinHighlights(t.poi))&&t.polygon.length>3){var e=this.wayfinder.map.getTransformer(),i=t.poi,n=null;if(i&&i.getGroups()){var s=i.getGroups()[0];s&&s.getColor()&&(n=s.getColor().toString())}this.context.fillStyle=this.overlayColorFromGroup&&n?n:this.overlayColor.toString();var o=e.transformPoint(t.polygon[0]);this.context.beginPath(),this.context.moveTo(o[0],o[1]);for(var r=0;r<t.polygon.length;r++)o=e.transformPoint(t.polygon[r]),this.context.lineTo(o[0],o[1]);this.context.closePath(),this.context.fill()}},renderPOIIcon:function(t,e){if(t&&t.getIcon()){var i=this.wayfinder.map.getTransformer(),n=this.wayfinder.overlays[t.id],s=t.getIcon().height/t.getIcon().width,o=(this.context,this.iconSize*i.getZoom());if(n&&0<n.length){var r=n[0].getBounds();boundWidth=r[2]*i.getZoom()/1.05,boundWidth<o&&(o=boundWidth),e=i.transformPoint([r[0]+r[2]/2,r[1]+r[3]/2])}this.isPOIinHighlights(t)&&(o=1.3*o);var a=o*s;this.context.drawImage(t.getIcon(),e[0]-o/2,e[1]-a/2,Math.round(o),Math.round(a))}},renderPOIName:function(t,e){var i=this.wayfinder.map.getTransformer(),n=t.getName(this.wayfinder.getLanguage()),s=Math.floor(this.nameFontSize*i.getZoom());this.context.font=s+"px "+this.nameFontFamily,this.context.textAlign="center";var o=this.wayfinder.overlays[t.id],r=this.context.measureText(n),a=0;if(this.context.save(),o&&0<o.length){var h=o[0].getRotatedAreaBounds();if(h){var u=Math.abs(h.bounds.width),c=Math.abs(h.bounds.height),d=u*i.getZoom()-this.fontPadding,l=c*i.getZoom()-this.fontPadding;if(a=this.calcNiceAngle(h.angle,n),0!==this.wayfinder.options.map2DRotation&&(a=this.wayfinder.options.map2DRotation*(Math.PI/180)-Math.abs(a)),c>1.1*u&&(a-=0===a?Math.PI/2:h.direction*(Math.PI/2),d=u*i.getZoom()-this.fontPadding,l=c*i.getZoom()-this.fontPadding),e=i.transformPoint(h.center),d<r.width){var f=d/r.width;if(s=Math.floor(s*f),10>s)return;this.context.font=s+"px "+this.nameFontFamily}s>l&&(s=Math.floor(l-this.fontPadding))}}else s=Math.max(12,Math.floor(.5*s)),this.context.font=s+"px "+this.nameFontFamily;var g=5;r=this.context.measureText(n);var p=r.width+2*g,m=s+g;this.context.rotate(a),e=i.rotatePoint(e,-a),this.nameBackgroundColor.a>0&&this.roundedRect(this.context,e[0]-p/2,e[1]-m/2,p,m,g,this.nameBackgroundColor.toString()),this.context.fillStyle=this.nameColor.toString(),this.context.textBaseline="middle",this.context.fillText(n,e[0],e[1]),this.context.restore()},roundedRect:function(t,e,i,n,s,o,r){t.beginPath(),t.moveTo(e,i+o),t.lineTo(e,i+s-o),t.quadraticCurveTo(e,i+s,e+o,i+s),t.lineTo(e+n-o,i+s),t.quadraticCurveTo(e+n,i+s,e+n,i+s-o),t.lineTo(e+n,i+o),t.quadraticCurveTo(e+n,i,e+n-o,i),t.lineTo(e+o,i),t.quadraticCurveTo(e,i,e,i+o),t.fillStyle=r,t.fill()},renderRotatedAreaBounds:function(t,e){var i=this.wayfinder.map.getTransformer(),n=i.transformPoint(e[0]),s=vec2.add(vec2.create(),n,e[1]);vec2.scale(s,s,i.getZoom());{var o=i.transformPoint(e[1]);i.transformPoint(e[0]),i.transformPoint(e[1])}this.context.beginPath(),this.context.fillStyle="rgba(255, 0, 0, 1.0)",this.context.arc(n[0],n[1],5*i.getZoom(),0,2*Math.PI,!0),this.context.closePath(),this.context.fill(),this.context.beginPath(),this.context.fillStyle="rgba(0, 255, 0, 1.0)",this.context.arc(s[0],s[1],3*i.getZoom(),0,2*Math.PI,!0),this.context.closePath(),this.context.fill(),this.context.beginPath(),this.context.fillStyle="rgba(0, 0, 255, 1.0)",this.context.arc(o[0],o[1],3*i.getZoom(),0,2*Math.PI,!0),this.context.closePath(),this.context.fill()},calcNiceAngle:function(t){t>Math.PI/2&&(t=Math.PI-t);var e=t/(Math.PI/2),i=Math.round(e)-e;return Math.abs(i)<.27&&(t=Math.round(e)*(Math.PI/2)),t},nearPI:function(t){var e=t/(Math.PI/2),i=Math.round(e)-e;return Math.abs(i)<.27?!0:!1},getBoundsMidPoint:function(t){var e=vec2.sub(vec2.create(),t[1],t[0]);vec2.scale(e,e,.5);var i=vec2.fromValues(-e[1],e[0]);vec2.normalize(i,i),vec2.scale(i,i,t[2]/2);var n=vec2.add(vec2.create(),t[0],e);return vec2.sub(n,n,i),n},getPOILocationOnMap:function(t){var e=this.wayfinder.map.getTransformer(),i=e.transformPoint(t.getNode().position2d);return i[0]>=0&&i[0]<=e.getViewWidth()&&i[1]>=0&&i[1]<=e.getViewHeight()?i:void 0},renderPolygon:function(t,e,i){var n=this.wayfinder.map.getTransformer(),s=n.transformPoint(vec2.fromValues(t[0][0],t[0][1]));this.context.fillStyle=e,this.context.beginPath(),i&&(s=n.rotatePoint(s,i)),this.context.moveTo(s[0],s[1]);for(var o=0;o<t.length;o++)s=n.transformPoint(vec2.set(s,t[o][0],t[o][1])),i&&(s=n.rotatePoint(s,i)),this.context.lineTo(s[0],s[1]);this.context.closePath(),this.context.fill()},drawRectangle:function(t,e,i,n,s,o){var r=this.wayfinder.map.getTransformer();e=r.transformPoint(e),s||(s=0),i*=r.getZoom(),n*=r.getZoom(),t.save(),t.strokeStyle=o,t.translate(e[0],e[1]),t.rotate(s),t.rect(0,0,i,n),t.stroke(),t.restore()},drawPoint:function(t,e,i){var n=this.wayfinder.map.getTransformer();this.context.beginPath(),this.context.fillStyle=i,this.context.arc(t[0],t[1],e*n.getZoom(),0,2*Math.PI,!0),this.context.closePath(),this.context.fill()}}),PathRenderer2D=Renderer2D.extend({init:function(){this._super(3),this.spots=[],this.position=0,this.timer=!1,this.animating=!1},onAdd:function(){this.spotColor=this.wayfinder.settings.getColor("path.2d.color","rgba(255,0,0,0.8)"),this.pathPauseTime=this.wayfinder.settings.getInt("path.2d.pause-time",this.wayfinder.options.pathPauseTime),this.messageSize=this.wayfinder.settings.getInt("path.2d.message-size",this.wayfinder.options.path2DMessageSize),this.spotSize=this.wayfinder.settings.getFloat("path.2d.size",this.wayfinder.options.pathSpotRadius),this.pathSpeed=this.wayfinder.settings.getFloat("path.2d.speed",this.wayfinder.options.pathSpeed),this.pathStride=this.wayfinder.settings.getFloat("path.2d.stride",this.wayfinder.options.pathStride),this.spotSize<.1&&(this.spotSize=.1),this.pathSpeed<.05&&(this.pathSpeed=.05),this.pathStride<.05&&(this.pathStride=.05)},reset:function(){this.position=0},setPath:function(t,e){if(t instanceof Path2D&&!t.isEmpty()){this.timer!==!1&&(clearTimeout(this.timer),this.timer=!1),this.spots=[],this.position=0;for(var i,n=0,s=this.pathStride,o=1;o<t.nodes.length;o++){var r=t.nodes[o-1].position2d,a=t.nodes[o].position2d,h=vec2.normalize(vec2.create(),vec2.subtract(vec2.create(),a,r)),u=vec2.distance(r,a);if("portal"==t.nodes[o-1].type&&"portal"==t.nodes[o].type)this.spots.push({floor:t.nodes[o-1].floor,position:t.nodes[o-1].position2d,node:t.nodes[o-1]});else for(var c=n;u>c;c+=s)i={floor:t.nodes[o-1].floor,position:vec2.add(vec2.create(),r,vec2.scale(vec2.create(),h,c))},c+s>u&&(n=s-(u-c),i.node=t.nodes[o]),this.spots.push(i)}var d=function(t,e){for(var i=0,n=e+1;n<t.length;n++)if(t[n].floor.id==t[n-1].floor.id){if(i++,2==i)return t[n].floor}else i=0;return!1},l=this;this.animating=!0;var f=function(){var t=l.spots[l.position];if(l.renderSpot(l.position),l.position++,t&&t.node&&l.wayfinder.cbOnPathStep(t),l.position==l.spots.length)return void(e&&"function"==typeof e&&e());var i=0;if(l.position<l.spots.length-1&&t.floor.id!=t.floor.id){var n=d(l.spots,l.position+1);if(i=l.pathPauseTime,n&&l.wayfinder.options.pathDisplayInstructions){var s=l.wayfinder.map.getTransformer().transformPoint(vec2.add(vec2.create(),t.position,vec2.fromValues(0,10))),o=l.wayfinder.getLanguage(),r=l.wayfinder.translator.get("go_to_floor",[l.wayfinder.map.getCurrentFloor().getName(o),n.getName(o)]);l.renderMessage(s,r)}}l.position>0&&l.spots[l.position-1].floor.id!=t.floor.id&&(l.wayfinder.showFloor(t.floor),l.wayfinder.map.renderer.damageAll(),l.wayfinder.map.renderer.render()),l.timer=setTimeout(f,l.pathSpeed+i)};this.timer=setTimeout(f,this.wayfinder.options.pathSpeed)}},clearPath:function(){this.position=0,this.spots=[],clearTimeout(this.timer)},renderMessage:function(t,e){var i=20;this.context.save(),this.context.font="bold "+this.messageSize+"px sans-serif",this.context.textBaseline="top",this.context.textAlign="center",this.context.fillStyle="rgba(40,40,40,0.75)";var n=this.context.measureText(e).width;this.context.fillRect(t[0]-(n+i)/2,t[1],n+i,this.messageSize+i),this.context.fillStyle="rgba(255,255,255,1.0)",this.context.fillText(e,t[0],t[1]+i/2),this.context.restore()},renderSpot:function(t){var e=this.wayfinder.map.getTransformer();this.context.save();var i=e.transformPoint(this.spots[t].position);this.context.beginPath(),this.context.fillStyle=this.spotColor.toString(),this.context.arc(i[0],i[1],this.spotSize*e.getZoom(),0,2*Math.PI,!0),this.context.closePath(),this.context.fill(),this.context.restore()},render:function(){if(0!==this.spots.length){var t=this.wayfinder.map.getCurrentFloor();this.context.save();for(var e=0;e<this.position;e++)this.spots[e].floor.id==t.id&&this.renderSpot(e);this.context.restore()}}}),NodesRenderer2D=Renderer2D.extend({init:function(){this._super(2)},render:function(){var t=this.wayfinder.map.getTransformer(),e=this.wayfinder.map.getCurrentFloor();if(e){this.context.save();for(var i in e.nodes){var n=t.transformPoint(e.nodes[i].position2d);this.context.beginPath(),this.context.fillStyle="rgba(60,120,0,0.7)",this.context.arc(n[0],n[1],2,0,2*Math.PI,!0),this.context.closePath(),this.context.fill(),this.context.fillText(e.nodes[i].id,n[0]+2,n[1]+2)}this.context.restore()}}}),EdgesRenderer2D=Renderer2D.extend({init:function(){this._super(2)},render:function(){var t=this.wayfinder.map.getTransformer(),e=this.wayfinder.map.getCurrentFloor();if(e){this.context.save();for(var i in e.nodes){var n=t.transformPoint(e.nodes[i].position2d);for(var s in e.nodes[i].neighbours){var o=t.transformPoint(e.nodes[i].neighbours[s].position2d);this.context.lineWidth=1,this.context.strokeStyle="rgba(10,10,10,0.1)",this.context.beginPath(),this.context.moveTo(n[0],n[1]),this.context.lineTo(o[0],o[1]),this.context.closePath(),this.context.stroke()}}this.context.restore()}}}),ExtrasRenderer2D=Renderer2D.extend({init:function(){this._super(5),this.yahSize=30},onAdd:function(){this.yahSize=this.wayfinder.settings.getInt("poi.2d.icon-size",this.wayfinder.options.poiRadius)},render:function(){var t=this.wayfinder.map.getTransformer();if(this.context.save(),this.wayfinder.options.drawKioskIcon&&this.wayfinder.getKioskNode()!==!1&&this.wayfinder.getKioskNode().floor.id==this.wayfinder.map.currentFloorID){var e=this.wayfinder.yahImage;if(!e)return;var i=t.transformPoint(this.wayfinder.getKioskNode().position2d),n=this.yahSize*t.getZoom(),s=n/e.width*e.height;this.context.drawImage(e,i[0]-n/2,i[1]-s,n,s)}if(this.wayfinder.geolocation&&this.wayfinder.options.enableUserLocation){var o=t.transformPoint(this.wayfinder.geolocation.getCurrentPosition());this.context.beginPath(),this.context.fillStyle="rgba(0, 0, 200, 1.0)",this.context.arc(o[0],o[1],3*t.getZoom(),0,2*Math.PI,!0),this.context.closePath(),this.context.fill()}this.context.restore()}}),Wayfinder2DRendering=Class.extend({init:function(t){this.wayfinder=null,this.context=null,this.renderers=[],t&&t instanceof Wayfinder&&(this.wayfinder=t),this.wayfinder&&(this.context=this.wayfinder.canvas.getContext("2d"))},damageAll:function(){for(var t in this.renderers)this.renderers[t].damage()},render:function(){for(var t=this.wayfinder.map.getTransformer(),e=new Rectangle(t.getX(),t.getY(),t.getUnzoomedViewWidth(),t.getUnzoomedViewHeight()),i=!1,n=0;n<this.renderers.length;n++)this.renderers[n].enabled&&this.renderers[n].damaged&&(this.renderers[n].render(e),this.renderers[n].undamage(),i=!0)},add:function(t){if(!(t instanceof Renderer2D))return!1;t.setContext(this.context),t.setWayfinder(this.wayfinder);for(var e=0;e<this.renderers.length;e++)if(t.renderQueue<this.renderers[e].renderQueue)return this.renderers.splice(e,0,t),t.onAdd(),!0;return this.renderers.push(t),t.onAdd(),!0}}),Map2D=Class.extend({init:function(t){this.wayfinder=!1,t instanceof Wayfinder&&(this.wayfinder=t),this.currentFloorID=-1,this.highlights=[],this.LODImages=[],this.onUpdateCallback=null,this.renderAll=!1,this.renderOnlyBase=!1,this.renderCycle=null,this.renderInterval=22,this.wayfinder.padding=0,this.onPOIClick=!1,this.wayfinder.cbOnPositionUpdate=ClassCallback(this,this.onPositionUpdate),this.setup(),this.mapMover.cbOnClick=ClassCallback(this,this.onClick),this.mapMover.cbOnLongClick=ClassCallback(this,this.onLongClick)},setup:function(){this.renderer=new Wayfinder2DRendering(this.wayfinder),this.mapMover=new Map2DMover(this.wayfinder.options,ClassCallback(this,this.update)),this.pathRenderer=new PathRenderer2D,this.floorRenderer=new FloorRenderer2D,this.poisRenderer=new POIsRenderer2D,this.extrasRenderer=new ExtrasRenderer2D},start:function(){var t=this;this.renderAll=!0;var e=function(){t.renderAll?(t.renderer.damageAll(),t.renderer.render(),t.renderAll=!1,t.renderOnlyBase=!1):t.renderOnlyBase&&(t.floorRenderer.damage(),t.renderer.render(),t.renderOnlyBase=!1),t.renderCycle=requestAnimFrame(e,this.renderInterval)};this.renderCycle=requestAnimFrame(e,this.renderInterval)},addLODImage:function(t,e,i,n,s){this.LODImages&&(this.LODImages[t]||(this.LODImages[t]=[]),this.LODImages[t][e]||(this.LODImages[t][e]=[]),this.LODImages[t][e][i]||(this.LODImages[t][e][i]=[]),this.LODImages[t][e][i][n]||(this.LODImages[t][e][i][n]=[]),this.LODImages[t][e][i][n]=s)},getLODImage:function(t,e,i,n){return this.LODImages[t]&&this.LODImages[t][e]&&this.LODImages[t][e][i]&&this.LODImages[t][e][i][n]?this.LODImages[t][e][i][n]:!1},getContainerNeededLevel:function(){var t=0,e=Math.max(this.getTransformer().getZoomedMapWidth(),this.getTransformer().getZoomedMapHeight()),i=Math.floor(e/this.wayfinder.options.mapSize[0]);return t=Math.min(i,this.wayfinder.options.maxLOD)},getMaxLODLevel:function(t){var e=0;if(this.LODImages[t]){for(var i=0;i<=this.wayfinder.options.maxLOD;i++)this.LODImages[t][i]&&this.LODImages[t][i].length==Math.pow(2,i)&&this.imagesInLevel(t,i)==Math.pow(4,i)&&(e=i);e=Math.max(0,Math.min(e,this.wayfinder.options.maxLOD))}return e},imagesInLevel:function(t,e){var i=0;if(this.LODImages[t]&&this.LODImages[t][e])for(var n in this.LODImages[t][e])this.LODImages[t][e][n]&&(i+=this.LODImages[t][e][n].length);return i},addRenderers:function(){this.renderer.add(this.floorRenderer),this.renderer.add(this.poisRenderer),this.renderer.add(this.pathRenderer),this.renderer.add(this.extrasRenderer)},onPositionUpdate:function(){var t=this.wayfinder.geolocation.currentPosition,e=this.wayfinder.geolocation.currentGeoPosition;console.log("=== Position Update ==="),console.log("Geo.pos: ("+e[0]+", "+e[1]+")",e),console.log("Map.pos: ("+t[0]+", "+t[1]+")",t);var i;i=void 0===t[0]?this.findNearestNodeOnFloor(this.getCurrentFloor(),vec2.fromValues(t.x,t.y)):this.findNearestNodeOnFloor(this.getCurrentFloor(),t),i!==!1&&(this.wayfinder.kiosk=i),this.update(!0)},onClick:function(t){var e=this.getCurrentFloor();if(e){var i=this.getTransformer().inverseTransformPoint(t);this.wayfinder.options.debugMouseLocation&&(this.floorRenderer.debugPoint=i);for(var n in e.nodes)if(0!==e.nodes[n].pois.length)for(var s in e.nodes[n].pois){var o=e.nodes[n].pois[s];if(o.id in this.wayfinder.overlays)for(var r in this.wayfinder.overlays[o.id])if(this.wayfinder.overlays[o.id][r].contains(i))return void this.openPOI(o,t);if(vec2.distance(i,e.nodes[n].position2d)<this.wayfinder.options.poiRadius)return void this.openPOI(o,t)}}},openPOI:function(t,e){this.highlights.length=0,this.highlights.push(t),this.pathRenderer.clearPath(),this.update(!0),this.onPOIClick&&"function"==typeof this.onPOIClick&&this.onPOIClick(t,e)},onLongClick:function(t){if(this.wayfinder.options.enableUserYAHSetting){var e=this.getTransformer().inverseTransformPoint(t),i=this.findNearestNodeOnFloor(this.getCurrentFloor(),e);i!==!1&&(this.wayfinder.kiosk=i,this.update(!0))}},update:function(t){this.wayfinder.options.enableLOD&&this.checkLODLevels(),t||this.wayfinder.options.forceFullMapUpdate===!0?this.renderAll=!0:this.renderOnlyBase=!0,"function"==typeof this.wayfinder.cbOnMapUpdate&&this.wayfinder.cbOnMapUpdate(t)},resize:function(t,e){this.wayfinder.canvas.setAttribute("width",t+"px"),this.wayfinder.canvas.setAttribute("height",e+"px"),this.getTransformer().setViewSize(vec2.fromValues(t,e)),this.update(!0)},getTransformer:function(){return this.mapMover.mapTransformer},getCurrentFloor:function(){return this.currentFloorID in this.wayfinder.building.getFloors()?this.wayfinder.building.getFloors()[this.currentFloorID]:!1},setCurrentFloor:function(t){t instanceof Floor&&(this.currentFloorID=t.id,this.update(!0))},fitPathInView:function(t){if(t!==!1){var e=t.getBounds(),i=this.getTransformer(),n=vec2.fromValues(this.wayfinder.padding,this.wayfinder.padding),s=vec2.add(vec2.create(),e.size,n),o=-1;e.size[0]>e.size[1]?(o=i.getViewWidth()/s[0],(o<i.getZoom()||this.wayfinder.options.pathZoomIn)&&i.setZoom(o)):(o=i.getViewHeight()/s[1],(o<i.getZoom()||this.wayfinder.options.pathZoomIn)&&i.setZoom(o)),i.setPosition(e.min[0]-(i.getUnzoomedViewWidth()/2-e.size[0]/2),e.min[1]-(i.getUnzoomedViewHeight()/2-e.size[1]/2))}},fitPOIInView:function(t){if(t!==!1){var e=this.wayfinder.overlays[t.id],i=[0,0,0,0];i=e&&e.length>0?e[0].getBounds():[t.getNode().position2d[0],t.getNode().position2d[1],1,1];var n=this.getTransformer(),s=[Math.max(i[0]-this.wayfinder.padding,0),Math.max(i[1]-this.wayfinder.padding,0),Math.min(i[2]+2*this.wayfinder.padding,n.getMapWidth()),Math.min(i[3]+2*this.wayfinder.padding,n.getMapHeight())];n.setZoom(i[2]>i[3]?Math.min(n.getZoom(),n.getViewWidth()/s[2]):Math.min(n.getZoom(),n.getViewHeight()/s[3]));var o=n.getPosition(),r=0,a=0;r=Math.min(0,s[0]-o[0]),a=Math.min(0,s[1]-o[1]),r=Math.max(r,s[0]+s[2]-o[0]-n.getViewWidth()),a=Math.max(a,s[1]+s[3]-o[1]-n.getViewHeight()),n.setPosition(o[0]+r,o[1]+a)}},fitMultiplePOIsInView:function(t){if(t!==!1){var e=!1,i=1024,n=1024,s=0,o=0;this.wayfinder.kiosk&&(s=this.wayfinder.kiosk.position2d[0],o=this.wayfinder.kiosk.position2d[1]);var r=!1;for(var a in t)e=t[a],e&&e.getNode()&&(r=this.wayfinder.overlays[e.id],r&&r.length>0&&r[0].getBounds()?(i=Math.min(i,r[0].getBounds()[0]),n=Math.min(n,r[0].getBounds()[1]),s=Math.max(s,r[0].getBounds()[0]+r[0].getBounds()[2]),o=Math.max(o,r[0].getBounds()[1]+r[0].getBounds()[3])):e.getNode().position2d&&(i=Math.min(i,e.getNode().position2d[0]),n=Math.min(n,e.getNode().position2d[1]),s=Math.max(s,e.getNode().position2d[0]),o=Math.max(o,e.getNode().position2d[1])));var h=[i,n,s-i,o-n],u=this.getTransformer();h[0]=Math.max(1,h[0]-this.wayfinder.padding),h[1]=Math.max(1,h[1]-this.wayfinder.padding),h[2]=Math.min(u.mapSize[0],h[2]+2*this.wayfinder.padding),h[3]=Math.min(u.mapSize[1],h[3]+2*this.wayfinder.padding);var c=u.getViewWidth()/h[2];c=Math.min(c,u.getViewHeight()/h[3]),u.setZoom(c),u.setPosition(h[0]-(u.getUnzoomedViewWidth()/2-h[2]/2),h[1]-(u.getUnzoomedViewHeight()/2-h[3]/2))}},checkLODLevels:function(){if(this.currentFloorID>-1){var t=this.getMaxLODLevel(this.currentFloorID),e=this.getContainerNeededLevel(),i=this.isLODLoading(this.currentFloorID,e),n=this.isLODLoaded(this.currentFloorID,e);this.floorRenderer.setLOD(n?e:t),i||this.preloadNextLODLevel(this.currentFloorID,e)}},isLODLoading:function(t,e){return this.LODImages[t]&&this.LODImages[t][e]?!0:!1},isLODLoaded:function(t,e){return this.LODImages[t]&&this.LODImages[t][e]&&this.LODImages[t][e]&&this.LODImages[t][e].length==Math.pow(2,e)&&this.imagesInLevel(t,e)==Math.pow(4,e)?!0:!1},getCurrentLOD:function(t,e,i){if(t>-1){var n=this.getLODImage(this.currentFloorID,t,e,i);if(n)return n}return!1},preloadNextLODLevel:function(t,e){if(t&&e<this.wayfinder.options.maxLOD){var i=this,n=Math.pow(2,e);this.LODImages[t]||(this.LODImages[t]=[]),this.LODImages[t][e]||(this.LODImages[t][e]=[]);for(var s=function(n){var s=[];for(var o in n)s=o.split("_"),i.addLODImage(s[0],s[1],s[2],s[3],n[o]);i.afterPreload(t,e)},o={},r=0;n>r;r++)for(var a=0;n>a;a++)o[t+"_"+e+"_"+r+"_"+a]={url:WayfinderAPI.getURL("2d","lod",[t,e,r,a]),type:"image"};Logistics.getMultiple(o,s)}},afterPreload:function(){this.update(!0)},setHighlights:function(t){this.highlights=t},clearHighlights:function(){this.highlights=[]},findNearestNodeOnFloor:function(t,e){if(!(t instanceof Floor))return!1;var i=1/0,n=!1;for(var s in t.nodes){var o=vec2.distance(e,t.nodes[s].position2d);i>o&&(n=t.nodes[s],i=o)}return n},setZoom:function(t){var e=this.getTransformer();e.setZoomPercentage(t)},zoomIn:function(){this.mapMover.mapTransformer.zoomIn()},zoomOut:function(){this.mapMover.mapTransformer.zoomOut()},redraw:function(){this.renderer.damageAll(),this.renderer.render()},getPOILocationOnMap:function(t){return this.poisRenderer.getPOILocationOnMap(t)},onMapUpdate:function(){"function"==typeof this.wayfinder.cbOnMapUpdate&&this.wayfinder.cbOnMapUpdate()}}),Map2DFallback=Map2D.extend({init:function(t){this.wayfinder=!1,t instanceof Wayfinder&&(this.wayfinder=t),this.currentFloorID=0,this.highlights=new Array,this.LODImages=new Array,this.onPOIClick=!1,this.wayfinder.cbOnPositionUpdate=ClassCallback(this,this.onPositionUpdate),this.map=$("<div id='"+this.wayfinder.options.map+"_fallback''></div>"),$("#"+this.wayfinder.options.map).parent().append(this.map),this.map.text("Your browser does not support this application. Please upgrade your browser.")},update:function(){if(this.currentFloorID>0){var t=this.getCurrentLOD(this.currentFloorID,0,0);log(this.currentFloorID,t),t&&this.map.append(t)}},fitPathInView:function(){},fitMultiplePOIsInView:function(){},resize:function(){},zoomIn:function(){},zoomOut:function(){},addRenderers:function(){},redraw:function(){}}),Map2DMover=Class.extend({init:function(t,e){this.options=t,this.cbUpdate=e,this.cbOnClick=!1,this.cbOnLongClick=!1,this.mouseDelta=vec2.create(),this.mouseDown=!1,this.mouseDelta=vec2.create(),this.smoothPanning=!0,this.dragTimeout=null,this.panInterval=10,this.panSensitivity=.3,this.lastPinch=0,this.rendering=!1,this.lastDraw=-1,this.waitForFullRedraw=300,this.fullRedrawTimer=null,this._dragVec=vec2.create(),this.setup(),this.bindEvents()},setup:function(){this.view=document.getElementById(this.options.map),this.mapTransformer=new Map2DTransformer(vec2.fromValues(this.options.mapSize[0],this.options.mapSize[1]),vec2.fromValues(this.view.offsetWidth,this.view.offsetHeight),!0,this.options)},bindEvents:function(){Hammer(this.view).on("pinch",ClassCallback(this,this.onPinch)),Hammer(this.view).on("hold",ClassCallback(this,this.onHold)),Hammer(this.view).on("tap",ClassCallback(this,this.onTap)),Hammer(this.view).on("release",ClassCallback(this,this.stop)),Hammer(this.view).on("drag",ClassCallback(this,this.onDrag)),Hammer(this.view).on("dragend",ClassCallback(this,this.onEndDrag)),Hammer(this.view).on("dragstart",ClassCallback(this,this.onStartDrag)),this.bindMouseWheel(ClassCallback(this,this.onWheel))},stop:function(){this.cbUpdate(!0),this.lastPinch=0,this.mouseDelta=vec2.create()},getRelativeMousePosition:function(t){var e=this.view.getBoundingClientRect().left+document.body.scrollLeft,i=this.view.getBoundingClientRect().top+document.body.scrollTop,n=vec2.sub(vec2.create(),t,vec2.fromValues(e,i));return 0!==this.options.map2DRotation?this.mapTransformer.rotatePointAroundCenter(n,vec2.fromValues(this.mapTransformer.getViewWidth()/2,this.mapTransformer.getViewHeight()/2),-this.options.map2DRotation):n},bindMouseWheel:function(t){this.view.addEventListener?(this.view.addEventListener("mousewheel",t,!1),this.view.addEventListener("DOMMouseScroll",t,!1)):this.view.attachEvent("onmousewheel",t)},onStartDrag:function(t){this.stop(),this.mouseDelta=vec2.fromValues(t.gesture.deltaX,t.gesture.deltaY)},onDrag:function(t){if(t.gesture.preventDefault(),!this.rendering&&"drag"==t.type){var e=vec2.fromValues(t.gesture.deltaX,t.gesture.deltaY);0!==this.options.map2DRotation&&(e=this.mapTransformer.rotatePointAroundCenter(e,vec2.fromValues(0,0),-this.options.map2DRotation));var i=vec2.sub(this._dragVec,this.mouseDelta,e);this.pan(i,!1),this.mouseDelta=e}},pan:function(t,e){this.rendering=!0,"undefined"==typeof e&&(e=!0),this.mapTransformer.move(t),this.cbUpdate&&"function"==typeof this.cbUpdate&&(this.cbUpdate(e),this.lastDraw=(new Date).getTime()),null===this.fullRedrawTimer&&(this.fullRedrawTimer=setTimeout(ClassCallback(this,this.checkFullDraw),this.waitForFullRedraw)),this.rendering=!1},checkFullDraw:function(){var t=(new Date).getTime();this.lastDraw>0&&t-this.lastDraw>this.waitForFullRedraw?("function"==typeof this.cbUpdate&&this.cbUpdate(!0),this.fullRedrawTimer=null,this.lastDraw=-1):-1!==this.lastDraw&&(this.fullRedrawTimer=setTimeout(ClassCallback(this,this.checkFullDraw),this.waitForFullRedraw))},onEndDrag:function(t){if(void 0!==t&&"dragend"===t.type&&t.gesture){t.gesture.preventDefault(),this.timeout&&clearTimeout(this.timeout);var e=vec2.fromValues(t.gesture.velocityX,t.gesture.velocityY);if(this.smoothPanning&&vec2.sqrLen(e)>.3){var i=vec2.fromValues(t.gesture.deltaX,t.gesture.deltaY),n=vec2.create();vec2.multiply(n,i,e);var s=this,o=function(){var t=vec2.create();vec2.div(t,n,vec2.fromValues(13,13)),vec2.sub(n,n,t);var e=vec2.sqrLen(t);if(e>3){if(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(o,s.panInterval),!this.rendering){var i=vec2.negate(vec2.create(),t);s.pan(i,!1)}}else s.pan(vec2.create(),!0),s.lastDraw=-1};this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(o,this.panInterval)}this.pan(vec2.create(),!0),this.lastDraw=-1}},onHold:function(t){this.cbOnLongClick&&"function"==typeof this.cbOnLongClick&&this.cbOnLongClick(vec2.fromValues(t.gesture.center.pageX,t.gesture.center.pageY))},onTap:function(t){t.gesture.preventDefault(),this.timeout&&clearTimeout(this.timeout),this.cbOnClick&&"function"==typeof this.cbOnClick&&this.cbOnClick(this.getRelativeMousePosition(vec2.fromValues(t.gesture.center.pageX,t.gesture.center.pageY)))},onWheel:function(t){t=window.event||t,t.preventDefault?t.preventDefault():t.returnValue=!1;var e=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail)),i=function(t){return 0>t?-1:t>0?1:0},n=0;if("undefined"!=typeof e?n=i(e):"undefined"!=typeof t.detail&&(n=-i(t.detail)),n>0)this.mapTransformer.zoomIn();else{if(!(0>n))return;this.mapTransformer.zoomOut()}this.cbUpdate&&"function"==typeof this.cbUpdate&&this.cbUpdate(!0)},onPinch:function(t){
if(t.gesture.preventDefault(),!this.rendering&&t.gesture){0===this.lastPinch&&(this.lastPinch=this.mapTransformer.getZoom());var e=this.lastPinch*t.gesture.scale;this.pinch(e)}},pinch:function(t){this.rendering=!0,0!==t&&(this.mapTransformer.setZoom(t),this.cbUpdate&&"function"==typeof this.cbUpdate&&this.cbUpdate(!0)),this.rendering=!1},onDoubleTap:function(t){var e=t.gesture.center,i=(this.mapTransformer.getZoom()+2*this.mapTransformer.getZoomStep(),vec2.create());vec2.sub(i,vec2.fromValues(e.pageX,e.pageY),vec2.fromValues(this.view.getBoundingClientRect().left,this.view.getBoundingClientRect().top));var n=this.mapTransformer.inverseTransformPoint(e.pageX,e.pageY);this.mapTransformer.setPosition(n.x,n.y),this.cbUpdate&&"function"==typeof this.cbUpdate&&this.cbUpdate(!0)},onZoomInPressed:function(){this.mapTransformer.zoomIn(),this.cbUpdate&&"function"==typeof this.cbUpdate&&this.cbUpdate(!0),this.zoomTimer=setTimeout(ClassCallback(this,this.onZoomInPressed),this.zoomInterval)},onZoomOutPressed:function(){this.mapTransformer.zoomOut(),this.cbUpdate&&"function"==typeof this.cbUpdate&&this.cbUpdate(!0),this.zoomTimer=setTimeout(ClassCallback(this,this.onZoomOutPressed),this.zoomInterval)},onZoomEnd:function(){this.zoomTimer!==!1&&(clearTimeout(this.zoomTimer),this.zoomTimer=!1),this.cbUpdate&&"function"==typeof this.cbUpdate&&this.cbUpdate(!0)},viewScale:function(){var t=vec2.fromValues(this.view.offsetWidth,this.view.offsetHeight),e=window,i=document,n=i.documentElement,s=i.getElementsByTagName("body")[0],o=e.innerWidth||n.clientWidth||s.clientWidth,r=e.innerHeight||n.clientHeight||s.clientHeight,a=vec2.fromValues(o,r);return vec2.sqrLen(t)/vec2.sqrLen(a)}}),Map2DTransformer=Class.extend({init:function(t,e,i,n){this.position=vec2.create(),this.zoom=1,this.options=n,this.mapSize=t,this.viewSize=e,this.zoomRange=vec2.fromValues(.1,3),this.zoomSteps=30,this.centering=void 0!==i?i:!0,this.padding=void 0!==this.options.pathZoomPadding?this.options.pathZoomPadding:0,this.centerIfZoomedOut(),this.cbOnZoomChange=null},getPosition:function(){return this.position},getViewSize:function(){return this.viewSize},getMapPosition:function(){return vec2.negate(vec2.create(),this.position)},getZoomedMapPosition:function(){return vec2.negate(vec2.create(),this.getZoomedPosition())},getZoomedPosition:function(){return vec2.scale(vec2.create(),this.position,this.zoom)},getX:function(){return this.position[0]},getY:function(){return this.position[1]},getZoomedX:function(){return this.position[0]*this.zoom},getZoomedY:function(){return this.position[1]*this.zoom},getZoom:function(){return this.zoom},getZoomRange:function(){return this.zoomRange},getZoomStep:function(){return(this.zoomRange[1]-this.zoomRange[0])/this.zoomSteps},setPosition:function(t,e){this.position[0]=t,this.position[1]=e,this.position[0]=Math.min(this.position[0],this.getMapWidth()-this.getUnzoomedViewWidth()),this.position[1]=Math.min(this.position[1],this.getMapHeight()-this.getUnzoomedViewHeight()),this.position[0]=Math.max(this.position[0],0),this.position[1]=Math.max(this.position[1],0),this.centerIfZoomedOut()},setZoomedPosition:function(t,e){this.setPosition(t/this.getZoom(),e/this.getZoom())},move:function(t){this.setPosition(this.position[0]+t[0]/this.getZoom(),this.position[1]+t[1]/this.getZoom())},setViewSize:function(t){this.viewSize=t;var e=Math.min(this.viewSize[0],this.viewSize[1]),i=Math.max(this.viewSize[0],this.viewSize[1]);this.zoomRange[0]=e/this.mapSize[0],this.zoomRange[1]=Math.max(this.options.maxLOD,this.mapSize[0]*this.options.maxLOD/i)},setZoom:function(t){var e=this.getUnzoomedViewWidth(),i=this.getUnzoomedViewHeight();this.zoom=t,this.zoom<this.zoomRange[0]&&(this.zoom=this.zoomRange[0]),this.zoom>this.zoomRange[1]&&(this.zoom=this.zoomRange[1]);var n=this.getUnzoomedViewWidth()-e,s=this.getUnzoomedViewHeight()-i;if(this.setPosition(this.getX()-n/2,this.getY()-s/2),this.centerIfZoomedOut(),"function"==typeof this.cbOnZoomChange){var o=(this.zoomRange[1]-this.zoom)/(this.zoomRange[1]-this.zoomRange[0]);this.cbOnZoomChange(o)}},setZoomPercentage:function(t){var e=this.zoomRange[1]-(this.zoomRange[1]-this.zoomRange[0])*(1-t);this.setZoom(e)},centerIfZoomedOut:function(){this.centering&&(this.getUnzoomedViewWidth()>=this.getMapWidth()&&(this.position[0]=-(this.getUnzoomedViewWidth()-this.getMapWidth())/2),this.getUnzoomedViewHeight()>=this.getMapHeight()&&(this.position[1]=-(this.getUnzoomedViewHeight()-this.getMapHeight())/2))},zoomIn:function(){this.setZoom(this.getZoom()+this.getZoomStep())},zoomOut:function(){this.setZoom(this.getZoom()-this.getZoomStep())},zoomToFit:function(){this.zoom=this.mapSize[0]>this.mapSize[1]?this.viewSize[0]/this.mapSize[0]:this.viewSize[1]/this.mapSize[1],this.getZoomedMapHeight()>this.getViewHeight()&&(this.zoom=Math.min(this.viewSize[0],this.viewSize[1])/Math.min(this.mapSize[0],this.mapSize[1])),this.setZoom(this.zoom)},getMapWidth:function(){return this.mapSize[0]},getMapHeight:function(){return this.mapSize[1]},getZoomedMapWidth:function(){return this.mapSize[0]*this.zoom},getZoomedMapHeight:function(){return this.mapSize[1]*this.zoom},getViewWidth:function(){return this.viewSize[0]},getViewHeight:function(){return this.viewSize[1]},getUnzoomedViewWidth:function(){return this.viewSize[0]/this.zoom},getUnzoomedViewHeight:function(){return this.viewSize[1]/this.zoom},transformPoint:function(t){var e=vec2.add(vec2.create(),this.getZoomedMapPosition(),vec2.scale(vec2.create(),t,this.zoom));return 0!==this.options.map2DRotation?this.rotatePointAroundCenter(e,vec2.fromValues(this.getViewWidth()/2,this.getViewHeight()/2),this.options.map2DRotation):e},inverseTransformPoint:function(t){return vec2.scale(vec2.create(),vec2.sub(vec2.create(),t,this.getZoomedMapPosition()),1/this.zoom)},getDrawingArea:function(){this.viewSize;return vec2.add(vec2.create(),this.viewSize,this.getZoomedPosition())},rotatePoint:function(t,e){var i=t[0]*Math.cos(e)-t[1]*Math.sin(e),n=t[1]*Math.cos(e)+t[0]*Math.sin(e);return vec2.fromValues(i,n)},rotatePointAroundCenter:function(t,e,i){return i=i*Math.PI/180,vec2.fromValues(Math.cos(i)*(t[0]-e[0])-Math.sin(i)*(t[1]-e[1])+e[0],Math.sin(i)*(t[0]-e[0])+Math.cos(i)*(t[1]-e[1])+e[1])}}),Path2D=Class.extend({init:function(){this.nodes=[]},isEmpty:function(){return 0===this.nodes.length?!0:!1},getBounds:function(t){var e={min:vec2.create(),max:vec2.create(),center:vec2.create(),size:vec2.create()};if(this.nodes.length>0){e.min[0]=this.nodes[0].position2d[0],e.min[1]=this.nodes[0].position2d[1],e.max[0]=this.nodes[0].position2d[0],e.max[1]=this.nodes[0].position2d[1];for(var i=1;i<this.nodes.length;i++){var n=this.nodes[i].position2d[0],s=this.nodes[i].position2d[1];n<e.min[0]&&(e.min[0]=n),s<e.min[1]&&(e.min[1]=s),n>e.max[0]&&(e.max[0]=n),s>e.max[1]&&(e.max[1]=s)}}return t&&"function"==typeof t&&(e.min=t(e.min),e.max=t(e.max)),e.size[0]=e.max[0]-e.min[0],e.size[1]=e.max[1]-e.min[1],e.center[0]=e.min[0]+e.size[0]/2,e.center[1]=e.min[1]+e.size[1]/2,e}}),PathFinder2D=Class.extend({init:function(t){this.nodes=t,this.Infinity=Infinity,this.reset()},reset:function(){this.dist={},this.previous={},this.Q=[],this.searched={}},getNodeWithSmallestDistance:function(){for(var t=1/0,e=0,i=1;i<this.Q.length;i++)this.dist[this.Q[i]]<t&&(t=this.dist[this.Q[i]],e=i);return e},isSearched:function(t){return t in this.searched},decreaseKey:function(t){for(var e=0;e<this.Q.length&&this.Q[e]!=t;e++);for(var i=e-1;i>0&&this.dist[this.Q[e]]<this.dist[this.Q[i]];i--){var n=this.Q[i];this.Q[i]=this.Q[e],this.Q[e]=n,e=i}},distanceBetween:function(t,e){return vec3.len(vec3.fromValues(e.position[0]-t.position[0],e.position[1]-t.position[1],e.position[2]-t.position[2]))},find:function(t,e){if(this.reset(),!(t in this.nodes&&e in this.nodes))return!1;for(var i in this.nodes)this.dist[i]=this.Infinity,this.previous[i]=null,this.Q.push(i);for(this.dist[t]=0;this.Q.length>0;){var n=this.getNodeWithSmallestDistance(),s=this.Q[n];if(this.dist[s]==this.Infinity)break;if(this.Q.splice(n,1),this.searched[s]=!0,s==e){var o=new Path2D;for(s=e;null!==this.previous[s];)o.nodes.push(this.nodes[s]),s=this.previous[s];return o.nodes.push(this.nodes[t]),o.nodes.reverse(),o}for(var i=0;i<this.nodes[s].neighbours.length;i++){var r=this.nodes[s].neighbours[i];if(!this.isSearched(r.id)){var a=this.dist[s]+this.distanceBetween(this.nodes[s],r)+r.weight;a<this.dist[r.id]&&(this.dist[r.id]=a,this.previous[r.id]=s,this.decreaseKey(r.id))}}}return!1}});